"use strict";(self.webpackChunkwebsite_docusaurus=self.webpackChunkwebsite_docusaurus||[]).push([[3449,5830],{454:(e,t,r)=>{function n(e){if(null==e)throw new TypeError("Cannot destructure "+e)}r.d(t,{A:()=>n})},516:(e,t,r)=>{r.d(t,{M:()=>s});var n=r(8696),i=r(7387),a=r(7862),s=function(e){function t(r,n){return e.call(this,r,n,t.defaultProps)||this}return(0,i.A)(t,e),(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"CommandBuffer"}}])}(a.F);s.defaultProps=Object.assign({},a.F.defaultProps)},1101:(e,t,r)=>{r.d(t,{d:()=>s});var n=r(8696),i=r(7387),a=r(7862),s=function(e){function t(r,n){return e.call(this,r,n,t.defaultProps)||this}return(0,i.A)(t,e),(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"QuerySet"}}])}(a.F);s.defaultProps=Object.assign({},a.F.defaultProps,{type:void 0,count:void 0})},1243:(e,t,r)=>{r.d(t,{G:()=>u});var n=r(8696),i=r(7387),a=r(7862),s=r(7083),o=r(3522),u=function(e){function t(r,n){var i;return void 0===n&&(n={}),(i=e.call(this,r,n,t.defaultProps)||this).width=i.props.width,i.height=i.props.height,i}(0,i.A)(t,e);var r=t.prototype;return r.clone=function(e){var t=this.colorAttachments.map(function(t){return t.texture.clone(e)}),r=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer(Object.assign({},this.props,e,{colorAttachments:t,depthStencilAttachment:r}))},r.resize=function(e){var t=!e;if(e){var r=Array.isArray(e)?e:[e.width,e.height],n=r[0],i=r[1];t=t||i!==this.height||n!==this.width,this.width=n,this.height=i}t&&(o.R.log(2,"Resizing framebuffer "+this.id+" to "+this.width+"x"+this.height)(),this.resizeAttachments(this.width,this.height))},r.autoCreateAttachmentTextures=function(){var e=this;if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(function(t,r){if("string"==typeof t){var n=e.createColorTexture(t,r);return e.attachResource(n),n.view}return t instanceof s.g?t.view:t});var t=this.props.depthStencilAttachment;if(t)if("string"==typeof t){var r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof s.g?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t},r.createColorTexture=function(e,t){return this.device.createTexture({id:this.id+"-color-attachment-"+t,usage:s.g.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})},r.createDepthStencilTexture=function(e){return this.device.createTexture({id:this.id+"-depth-stencil-attachment",usage:s.g.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})},r.resizeAttachments=function(e,t){for(var r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){var n=this.colorAttachments[r].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=n.view,this.attachResource(n.view)}if(this.depthStencilAttachment){var i=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()},(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"Framebuffer"}}])}(a.F);u.defaultProps=Object.assign({},a.F.defaultProps,{width:1,height:1,colorAttachments:[],depthStencilAttachment:null})},1464:(e,t,r)=>{function n(e){return o[e]}function i(e){var t=s[e],r=t[0],n=t[1],i="i32"===r||"u32"===r,o="u32"!==r;return{primitiveType:r,components:n,byteLength:a[r]*n,integer:i,signed:o}}r.d(t,{k0:()=>n,wH:()=>i});var a={f32:4,f16:2,i32:4,u32:4},s={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},o={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}},u={vec2i:"vec2<i32>",vec3i:"vec3<i32>",vec4i:"vec4<i32>",vec2u:"vec2<u32>",vec3u:"vec3<u32>",vec4u:"vec4<u32>",vec2f:"vec2<f32>",vec3f:"vec3<f32>",vec4f:"vec4<f32>",vec2h:"vec2<f16>",vec3h:"vec3<f16>",vec4h:"vec4<f16>"};Object.assign({},u,{mat2x2f:"mat2x2<f32>",mat2x3f:"mat2x3<f32>",mat2x4f:"mat2x4<f32>",mat3x2f:"mat3x2<f32>",mat3x3f:"mat3x3<f32>",mat3x4f:"mat3x4<f32>",mat4x2f:"mat4x2<f32>",mat4x3f:"mat4x3<f32>",mat4x4f:"mat4x4<f32>",mat2x2i:"mat2x2<i32>",mat2x3i:"mat2x3<i32>",mat2x4i:"mat2x4<i32>",mat3x2i:"mat3x2<i32>",mat3x3i:"mat3x3<i32>",mat3x4i:"mat3x4<i32>",mat4x2i:"mat4x2<i32>",mat4x3i:"mat4x3<i32>",mat4x4i:"mat4x4<i32>",mat2x2u:"mat2x2<u32>",mat2x3u:"mat2x3<u32>",mat2x4u:"mat2x4<u32>",mat3x2u:"mat3x2<u32>",mat3x3u:"mat3x3<u32>",mat3x4u:"mat3x4<u32>",mat4x2u:"mat4x2<u32>",mat4x3u:"mat4x3<u32>",mat4x4u:"mat4x4<u32>",mat2x2h:"mat2x2<f16>",mat2x3h:"mat2x3<f16>",mat2x4h:"mat2x4<f16>",mat3x2h:"mat3x2<f16>",mat3x3h:"mat3x3<f16>",mat3x4h:"mat3x4<f16>",mat4x2h:"mat4x2<f16>",mat4x3h:"mat4x3<f16>",mat4x4h:"mat4x4<f16>"})},1649:(e,t,r)=>{var n;function i(e){return(!n||n.byteLength<e)&&(n=new ArrayBuffer(e)),n}function a(e,t){return new e(i(e.BYTES_PER_ELEMENT*t),0,t)}r.d(t,{X:()=>a,o:()=>i})},2018:(e,t,r)=>{r.d(t,{M:()=>u,P:()=>o});var n=r(3845),i=r(3522),a=r(1464),s=r(1990);function o(e,t){for(var r,i={},a=(0,n.A)(e.attributes);!(r=a()).done;){var s=r.value,o=c(e,t,s.name);o&&(i[s.name]=o)}return i}function u(e,t,r){void 0===r&&(r=16);for(var n=o(e,t),i=new Array(r).fill(null),a=0,s=Object.values(n);a<s.length;a++){var u=s[a];i[u.location]=u}return i}function c(e,t,r){var o=function(e,t){var r=e.attributes.find(function(e){return e.name===t});r||i.R.warn('shader layout attribute "'+t+'" not present in shader');return r||null}(e,r),u=function(e,t){l(e);var r=function(e,t){for(var r,i=(0,n.A)(e);!(r=i()).done;){var a=r.value;if(a.format&&a.name===t)return{attributeName:a.name,bufferName:t,stepMode:a.stepMode,vertexFormat:a.format,byteOffset:0,byteStride:a.byteStride||0}}return null}(e,t);if(r)return r;if(r=function(e,t){for(var r,i=(0,n.A)(e);!(r=i()).done;){var a,o=r.value,u=o.byteStride;if("number"!=typeof o.byteStride)for(var c,l=(0,n.A)(o.attributes||[]);!(c=l()).done;){var f=c.value;u+=(0,s.yx)(f.format).byteLength}var h=null==(a=o.attributes)?void 0:a.find(function(e){return e.attribute===t});if(h)return{attributeName:h.attribute,bufferName:o.name,stepMode:o.stepMode,vertexFormat:h.format,byteOffset:h.byteOffset,byteStride:u}}return null}(e,t),r)return r;return i.R.warn('layout for attribute "'+t+'" not present in buffer layout'),null}(t,r);if(!o)return null;var c=(0,a.wH)(o.type),f=(0,s.Mz)(c),h=(null==u?void 0:u.vertexFormat)||f,d=(0,s.yx)(h);return{attributeName:(null==u?void 0:u.attributeName)||o.name,bufferName:(null==u?void 0:u.bufferName)||o.name,location:o.location,shaderType:o.type,primitiveType:c.primitiveType,shaderComponents:c.components,vertexFormat:h,bufferDataType:d.type,bufferComponents:d.components,normalized:d.normalized,integer:c.integer,stepMode:(null==u?void 0:u.stepMode)||o.stepMode||"vertex",byteOffset:(null==u?void 0:u.byteOffset)||0,byteStride:(null==u?void 0:u.byteStride)||0}}function l(e){for(var t,r=(0,n.A)(e);!(t=r()).done;){var a=t.value;(a.attributes&&a.format||!a.attributes&&!a.format)&&i.R.warn("BufferLayout "+name+" must have either 'attributes' or 'format' field")}}},2645:(e,t,r)=>{r.d(t,{O:()=>a});var n=r(7387),i=r(7862),a=function(e){function t(r,n){var i;return void 0===n&&(n={}),(i=e.call(this,r,n,t.defaultProps)||this)[Symbol.toStringTag]="WEBGLFence",i}return(0,n.A)(t,e),t}(i.F);a.defaultProps=Object.assign({},i.F.defaultProps)},3145:(e,t,r)=>{r.d(t,{r:()=>s});var n=r(8696),i=r(7387),a=r(7862),s=function(e){function t(r,n){var i;return(i=e.call(this,r,n,t.defaultProps)||this).linkStatus="pending",i.hash="",i.shaderLayout=i.props.shaderLayout,i.bufferLayout=i.props.bufferLayout||[],i}return(0,i.A)(t,e),(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"RenderPipeline"}}])}(a.F);s.defaultProps=Object.assign({},a.F.defaultProps,{vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}})},3449:(e,t,r)=>{r.r(t),r.d(t,{WebGLDevice:()=>Gt});var n=r(8696);var i,a,s,o=r(7387),u=r(8174),c=r(3522),l=r(3845),f=r(3369),h=((i={})[f.GL.BLEND]=!1,i[f.GL.BLEND_COLOR]=new Float32Array([0,0,0,0]),i[f.GL.BLEND_EQUATION_RGB]=f.GL.FUNC_ADD,i[f.GL.BLEND_EQUATION_ALPHA]=f.GL.FUNC_ADD,i[f.GL.BLEND_SRC_RGB]=f.GL.ONE,i[f.GL.BLEND_DST_RGB]=f.GL.ZERO,i[f.GL.BLEND_SRC_ALPHA]=f.GL.ONE,i[f.GL.BLEND_DST_ALPHA]=f.GL.ZERO,i[f.GL.COLOR_CLEAR_VALUE]=new Float32Array([0,0,0,0]),i[f.GL.COLOR_WRITEMASK]=[!0,!0,!0,!0],i[f.GL.CULL_FACE]=!1,i[f.GL.CULL_FACE_MODE]=f.GL.BACK,i[f.GL.DEPTH_TEST]=!1,i[f.GL.DEPTH_CLEAR_VALUE]=1,i[f.GL.DEPTH_FUNC]=f.GL.LESS,i[f.GL.DEPTH_RANGE]=new Float32Array([0,1]),i[f.GL.DEPTH_WRITEMASK]=!0,i[f.GL.DITHER]=!0,i[f.GL.CURRENT_PROGRAM]=null,i[f.GL.FRAMEBUFFER_BINDING]=null,i[f.GL.RENDERBUFFER_BINDING]=null,i[f.GL.VERTEX_ARRAY_BINDING]=null,i[f.GL.ARRAY_BUFFER_BINDING]=null,i[f.GL.FRONT_FACE]=f.GL.CCW,i[f.GL.GENERATE_MIPMAP_HINT]=f.GL.DONT_CARE,i[f.GL.LINE_WIDTH]=1,i[f.GL.POLYGON_OFFSET_FILL]=!1,i[f.GL.POLYGON_OFFSET_FACTOR]=0,i[f.GL.POLYGON_OFFSET_UNITS]=0,i[f.GL.SAMPLE_ALPHA_TO_COVERAGE]=!1,i[f.GL.SAMPLE_COVERAGE]=!1,i[f.GL.SAMPLE_COVERAGE_VALUE]=1,i[f.GL.SAMPLE_COVERAGE_INVERT]=!1,i[f.GL.SCISSOR_TEST]=!1,i[f.GL.SCISSOR_BOX]=new Int32Array([0,0,1024,1024]),i[f.GL.STENCIL_TEST]=!1,i[f.GL.STENCIL_CLEAR_VALUE]=0,i[f.GL.STENCIL_WRITEMASK]=4294967295,i[f.GL.STENCIL_BACK_WRITEMASK]=4294967295,i[f.GL.STENCIL_FUNC]=f.GL.ALWAYS,i[f.GL.STENCIL_REF]=0,i[f.GL.STENCIL_VALUE_MASK]=4294967295,i[f.GL.STENCIL_BACK_FUNC]=f.GL.ALWAYS,i[f.GL.STENCIL_BACK_REF]=0,i[f.GL.STENCIL_BACK_VALUE_MASK]=4294967295,i[f.GL.STENCIL_FAIL]=f.GL.KEEP,i[f.GL.STENCIL_PASS_DEPTH_FAIL]=f.GL.KEEP,i[f.GL.STENCIL_PASS_DEPTH_PASS]=f.GL.KEEP,i[f.GL.STENCIL_BACK_FAIL]=f.GL.KEEP,i[f.GL.STENCIL_BACK_PASS_DEPTH_FAIL]=f.GL.KEEP,i[f.GL.STENCIL_BACK_PASS_DEPTH_PASS]=f.GL.KEEP,i[f.GL.VIEWPORT]=[0,0,1024,1024],i[f.GL.TRANSFORM_FEEDBACK_BINDING]=null,i[f.GL.COPY_READ_BUFFER_BINDING]=null,i[f.GL.COPY_WRITE_BUFFER_BINDING]=null,i[f.GL.PIXEL_PACK_BUFFER_BINDING]=null,i[f.GL.PIXEL_UNPACK_BUFFER_BINDING]=null,i[f.GL.FRAGMENT_SHADER_DERIVATIVE_HINT]=f.GL.DONT_CARE,i[f.GL.READ_FRAMEBUFFER_BINDING]=null,i[f.GL.RASTERIZER_DISCARD]=!1,i[f.GL.PACK_ALIGNMENT]=4,i[f.GL.UNPACK_ALIGNMENT]=4,i[f.GL.UNPACK_FLIP_Y_WEBGL]=!1,i[f.GL.UNPACK_PREMULTIPLY_ALPHA_WEBGL]=!1,i[f.GL.UNPACK_COLORSPACE_CONVERSION_WEBGL]=f.GL.BROWSER_DEFAULT_WEBGL,i[f.GL.PACK_ROW_LENGTH]=0,i[f.GL.PACK_SKIP_PIXELS]=0,i[f.GL.PACK_SKIP_ROWS]=0,i[f.GL.UNPACK_ROW_LENGTH]=0,i[f.GL.UNPACK_IMAGE_HEIGHT]=0,i[f.GL.UNPACK_SKIP_PIXELS]=0,i[f.GL.UNPACK_SKIP_ROWS]=0,i[f.GL.UNPACK_SKIP_IMAGES]=0,i),d=function(e,t,r){return t?e.enable(r):e.disable(r)},_=function(e,t,r){return e.hint(r,t)},L=function(e,t,r){return e.pixelStorei(r,t)},E=function(e,t,r){var n=r===f.GL.FRAMEBUFFER_BINDING?f.GL.DRAW_FRAMEBUFFER:f.GL.READ_FRAMEBUFFER;return e.bindFramebuffer(n,t)},g=function(e,t,r){var n,i=((n={})[f.GL.ARRAY_BUFFER_BINDING]=f.GL.ARRAY_BUFFER,n[f.GL.COPY_READ_BUFFER_BINDING]=f.GL.COPY_READ_BUFFER,n[f.GL.COPY_WRITE_BUFFER_BINDING]=f.GL.COPY_WRITE_BUFFER,n[f.GL.PIXEL_PACK_BUFFER_BINDING]=f.GL.PIXEL_PACK_BUFFER,n[f.GL.PIXEL_UNPACK_BUFFER_BINDING]=f.GL.PIXEL_UNPACK_BUFFER,n)[r];e.bindBuffer(i,t)};function p(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}var m=((a={})[f.GL.BLEND]=d,a[f.GL.BLEND_COLOR]=function(e,t){return e.blendColor.apply(e,t)},a[f.GL.BLEND_EQUATION_RGB]="blendEquation",a[f.GL.BLEND_EQUATION_ALPHA]="blendEquation",a[f.GL.BLEND_SRC_RGB]="blendFunc",a[f.GL.BLEND_DST_RGB]="blendFunc",a[f.GL.BLEND_SRC_ALPHA]="blendFunc",a[f.GL.BLEND_DST_ALPHA]="blendFunc",a[f.GL.COLOR_CLEAR_VALUE]=function(e,t){return e.clearColor.apply(e,t)},a[f.GL.COLOR_WRITEMASK]=function(e,t){return e.colorMask.apply(e,t)},a[f.GL.CULL_FACE]=d,a[f.GL.CULL_FACE_MODE]=function(e,t){return e.cullFace(t)},a[f.GL.DEPTH_TEST]=d,a[f.GL.DEPTH_CLEAR_VALUE]=function(e,t){return e.clearDepth(t)},a[f.GL.DEPTH_FUNC]=function(e,t){return e.depthFunc(t)},a[f.GL.DEPTH_RANGE]=function(e,t){return e.depthRange.apply(e,t)},a[f.GL.DEPTH_WRITEMASK]=function(e,t){return e.depthMask(t)},a[f.GL.DITHER]=d,a[f.GL.FRAGMENT_SHADER_DERIVATIVE_HINT]=_,a[f.GL.CURRENT_PROGRAM]=function(e,t){return e.useProgram(t)},a[f.GL.RENDERBUFFER_BINDING]=function(e,t){return e.bindRenderbuffer(f.GL.RENDERBUFFER,t)},a[f.GL.TRANSFORM_FEEDBACK_BINDING]=function(e,t){return null==e.bindTransformFeedback?void 0:e.bindTransformFeedback(f.GL.TRANSFORM_FEEDBACK,t)},a[f.GL.VERTEX_ARRAY_BINDING]=function(e,t){return e.bindVertexArray(t)},a[f.GL.FRAMEBUFFER_BINDING]=E,a[f.GL.READ_FRAMEBUFFER_BINDING]=E,a[f.GL.ARRAY_BUFFER_BINDING]=g,a[f.GL.COPY_READ_BUFFER_BINDING]=g,a[f.GL.COPY_WRITE_BUFFER_BINDING]=g,a[f.GL.PIXEL_PACK_BUFFER_BINDING]=g,a[f.GL.PIXEL_UNPACK_BUFFER_BINDING]=g,a[f.GL.FRONT_FACE]=function(e,t){return e.frontFace(t)},a[f.GL.GENERATE_MIPMAP_HINT]=_,a[f.GL.LINE_WIDTH]=function(e,t){return e.lineWidth(t)},a[f.GL.POLYGON_OFFSET_FILL]=d,a[f.GL.POLYGON_OFFSET_FACTOR]="polygonOffset",a[f.GL.POLYGON_OFFSET_UNITS]="polygonOffset",a[f.GL.RASTERIZER_DISCARD]=d,a[f.GL.SAMPLE_ALPHA_TO_COVERAGE]=d,a[f.GL.SAMPLE_COVERAGE]=d,a[f.GL.SAMPLE_COVERAGE_VALUE]="sampleCoverage",a[f.GL.SAMPLE_COVERAGE_INVERT]="sampleCoverage",a[f.GL.SCISSOR_TEST]=d,a[f.GL.SCISSOR_BOX]=function(e,t){return e.scissor.apply(e,t)},a[f.GL.STENCIL_TEST]=d,a[f.GL.STENCIL_CLEAR_VALUE]=function(e,t){return e.clearStencil(t)},a[f.GL.STENCIL_WRITEMASK]=function(e,t){return e.stencilMaskSeparate(f.GL.FRONT,t)},a[f.GL.STENCIL_BACK_WRITEMASK]=function(e,t){return e.stencilMaskSeparate(f.GL.BACK,t)},a[f.GL.STENCIL_FUNC]="stencilFuncFront",a[f.GL.STENCIL_REF]="stencilFuncFront",a[f.GL.STENCIL_VALUE_MASK]="stencilFuncFront",a[f.GL.STENCIL_BACK_FUNC]="stencilFuncBack",a[f.GL.STENCIL_BACK_REF]="stencilFuncBack",a[f.GL.STENCIL_BACK_VALUE_MASK]="stencilFuncBack",a[f.GL.STENCIL_FAIL]="stencilOpFront",a[f.GL.STENCIL_PASS_DEPTH_FAIL]="stencilOpFront",a[f.GL.STENCIL_PASS_DEPTH_PASS]="stencilOpFront",a[f.GL.STENCIL_BACK_FAIL]="stencilOpBack",a[f.GL.STENCIL_BACK_PASS_DEPTH_FAIL]="stencilOpBack",a[f.GL.STENCIL_BACK_PASS_DEPTH_PASS]="stencilOpBack",a[f.GL.VIEWPORT]=function(e,t){return e.viewport.apply(e,t)},a[f.GL.DEPTH_CLAMP_EXT]=d,a[f.GL.POLYGON_OFFSET_LINE_WEBGL]=d,a[f.GL.CLIP_DISTANCE0_WEBGL]=d,a[f.GL.CLIP_DISTANCE1_WEBGL]=d,a[f.GL.CLIP_DISTANCE2_WEBGL]=d,a[f.GL.CLIP_DISTANCE3_WEBGL]=d,a[f.GL.CLIP_DISTANCE4_WEBGL]=d,a[f.GL.CLIP_DISTANCE5_WEBGL]=d,a[f.GL.CLIP_DISTANCE6_WEBGL]=d,a[f.GL.CLIP_DISTANCE7_WEBGL]=d,a[f.GL.PACK_ALIGNMENT]=L,a[f.GL.UNPACK_ALIGNMENT]=L,a[f.GL.UNPACK_FLIP_Y_WEBGL]=L,a[f.GL.UNPACK_PREMULTIPLY_ALPHA_WEBGL]=L,a[f.GL.UNPACK_COLORSPACE_CONVERSION_WEBGL]=L,a[f.GL.PACK_ROW_LENGTH]=L,a[f.GL.PACK_SKIP_PIXELS]=L,a[f.GL.PACK_SKIP_ROWS]=L,a[f.GL.UNPACK_ROW_LENGTH]=L,a[f.GL.UNPACK_IMAGE_HEIGHT]=L,a[f.GL.UNPACK_SKIP_PIXELS]=L,a[f.GL.UNPACK_SKIP_ROWS]=L,a[f.GL.UNPACK_SKIP_IMAGES]=L,a.framebuffer=function(e,t){var r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(f.GL.FRAMEBUFFER,r)},a.blend=function(e,t){return t?e.enable(f.GL.BLEND):e.disable(f.GL.BLEND)},a.blendColor=function(e,t){return e.blendColor.apply(e,t)},a.blendEquation=function(e,t){var r="number"==typeof t?[t,t]:t;e.blendEquationSeparate.apply(e,r)},a.blendFunc=function(e,t){var r=2===(null==t?void 0:t.length)?[].concat(t,t):t;e.blendFuncSeparate.apply(e,r)},a.clearColor=function(e,t){return e.clearColor.apply(e,t)},a.clearDepth=function(e,t){return e.clearDepth(t)},a.clearStencil=function(e,t){return e.clearStencil(t)},a.colorMask=function(e,t){return e.colorMask.apply(e,t)},a.cull=function(e,t){return t?e.enable(f.GL.CULL_FACE):e.disable(f.GL.CULL_FACE)},a.cullFace=function(e,t){return e.cullFace(t)},a.depthTest=function(e,t){return t?e.enable(f.GL.DEPTH_TEST):e.disable(f.GL.DEPTH_TEST)},a.depthFunc=function(e,t){return e.depthFunc(t)},a.depthMask=function(e,t){return e.depthMask(t)},a.depthRange=function(e,t){return e.depthRange.apply(e,t)},a.dither=function(e,t){return t?e.enable(f.GL.DITHER):e.disable(f.GL.DITHER)},a.derivativeHint=function(e,t){e.hint(f.GL.FRAGMENT_SHADER_DERIVATIVE_HINT,t)},a.frontFace=function(e,t){return e.frontFace(t)},a.mipmapHint=function(e,t){return e.hint(f.GL.GENERATE_MIPMAP_HINT,t)},a.lineWidth=function(e,t){return e.lineWidth(t)},a.polygonOffsetFill=function(e,t){return t?e.enable(f.GL.POLYGON_OFFSET_FILL):e.disable(f.GL.POLYGON_OFFSET_FILL)},a.polygonOffset=function(e,t){return e.polygonOffset.apply(e,t)},a.sampleCoverage=function(e,t){return e.sampleCoverage(t[0],t[1]||!1)},a.scissorTest=function(e,t){return t?e.enable(f.GL.SCISSOR_TEST):e.disable(f.GL.SCISSOR_TEST)},a.scissor=function(e,t){return e.scissor.apply(e,t)},a.stencilTest=function(e,t){return t?e.enable(f.GL.STENCIL_TEST):e.disable(f.GL.STENCIL_TEST)},a.stencilMask=function(e,t){var r=t=p(t)?t:[t,t],n=r[0],i=r[1];e.stencilMaskSeparate(f.GL.FRONT,n),e.stencilMaskSeparate(f.GL.BACK,i)},a.stencilFunc=function(e,t){var r=t=p(t)&&3===t.length?[].concat(t,t):t,n=r[0],i=r[1],a=r[2],s=r[3],o=r[4],u=r[5];e.stencilFuncSeparate(f.GL.FRONT,n,i,a),e.stencilFuncSeparate(f.GL.BACK,s,o,u)},a.stencilOp=function(e,t){var r=t=p(t)&&3===t.length?[].concat(t,t):t,n=r[0],i=r[1],a=r[2],s=r[3],o=r[4],u=r[5];e.stencilOpSeparate(f.GL.FRONT,n,i,a),e.stencilOpSeparate(f.GL.BACK,s,o,u)},a.viewport=function(e,t){return e.viewport.apply(e,t)},a);function G(e,t,r){return void 0!==t[e]?t[e]:r[e]}var A={blendEquation:function(e,t,r){return e.blendEquationSeparate(G(f.GL.BLEND_EQUATION_RGB,t,r),G(f.GL.BLEND_EQUATION_ALPHA,t,r))},blendFunc:function(e,t,r){return e.blendFuncSeparate(G(f.GL.BLEND_SRC_RGB,t,r),G(f.GL.BLEND_DST_RGB,t,r),G(f.GL.BLEND_SRC_ALPHA,t,r),G(f.GL.BLEND_DST_ALPHA,t,r))},polygonOffset:function(e,t,r){return e.polygonOffset(G(f.GL.POLYGON_OFFSET_FACTOR,t,r),G(f.GL.POLYGON_OFFSET_UNITS,t,r))},sampleCoverage:function(e,t,r){return e.sampleCoverage(G(f.GL.SAMPLE_COVERAGE_VALUE,t,r),G(f.GL.SAMPLE_COVERAGE_INVERT,t,r))},stencilFuncFront:function(e,t,r){return e.stencilFuncSeparate(f.GL.FRONT,G(f.GL.STENCIL_FUNC,t,r),G(f.GL.STENCIL_REF,t,r),G(f.GL.STENCIL_VALUE_MASK,t,r))},stencilFuncBack:function(e,t,r){return e.stencilFuncSeparate(f.GL.BACK,G(f.GL.STENCIL_BACK_FUNC,t,r),G(f.GL.STENCIL_BACK_REF,t,r),G(f.GL.STENCIL_BACK_VALUE_MASK,t,r))},stencilOpFront:function(e,t,r){return e.stencilOpSeparate(f.GL.FRONT,G(f.GL.STENCIL_FAIL,t,r),G(f.GL.STENCIL_PASS_DEPTH_FAIL,t,r),G(f.GL.STENCIL_PASS_DEPTH_PASS,t,r))},stencilOpBack:function(e,t,r){return e.stencilOpSeparate(f.GL.BACK,G(f.GL.STENCIL_BACK_FAIL,t,r),G(f.GL.STENCIL_BACK_PASS_DEPTH_FAIL,t,r),G(f.GL.STENCIL_BACK_PASS_DEPTH_PASS,t,r))}},v={enable:function(e,t){var r;return e(((r={})[t]=!0,r))},disable:function(e,t){var r;return e(((r={})[t]=!1,r))},pixelStorei:function(e,t,r){var n;return e(((n={})[t]=r,n))},hint:function(e,t,r){var n;return e(((n={})[t]=r,n))},useProgram:function(e,t){var r;return e(((r={})[f.GL.CURRENT_PROGRAM]=t,r))},bindRenderbuffer:function(e,t,r){var n;return e(((n={})[f.GL.RENDERBUFFER_BINDING]=r,n))},bindTransformFeedback:function(e,t,r){var n;return e(((n={})[f.GL.TRANSFORM_FEEDBACK_BINDING]=r,n))},bindVertexArray:function(e,t){var r;return e(((r={})[f.GL.VERTEX_ARRAY_BINDING]=t,r))},bindFramebuffer:function(e,t,r){var n,i,a;switch(t){case f.GL.FRAMEBUFFER:return e(((n={})[f.GL.DRAW_FRAMEBUFFER_BINDING]=r,n[f.GL.READ_FRAMEBUFFER_BINDING]=r,n));case f.GL.DRAW_FRAMEBUFFER:return e(((i={})[f.GL.DRAW_FRAMEBUFFER_BINDING]=r,i));case f.GL.READ_FRAMEBUFFER:return e(((a={})[f.GL.READ_FRAMEBUFFER_BINDING]=r,a));default:return null}},bindBuffer:function(e,t,r){var n,i,a=(n={},n[f.GL.ARRAY_BUFFER]=[f.GL.ARRAY_BUFFER_BINDING],n[f.GL.COPY_READ_BUFFER]=[f.GL.COPY_READ_BUFFER_BINDING],n[f.GL.COPY_WRITE_BUFFER]=[f.GL.COPY_WRITE_BUFFER_BINDING],n[f.GL.PIXEL_PACK_BUFFER]=[f.GL.PIXEL_PACK_BUFFER_BINDING],n[f.GL.PIXEL_UNPACK_BUFFER]=[f.GL.PIXEL_UNPACK_BUFFER_BINDING],n)[t];return a?e(((i={})[a]=r,i)):{valueChanged:!0}},blendColor:function(e,t,r,n,i){var a;return e(((a={})[f.GL.BLEND_COLOR]=new Float32Array([t,r,n,i]),a))},blendEquation:function(e,t){var r;return e(((r={})[f.GL.BLEND_EQUATION_RGB]=t,r[f.GL.BLEND_EQUATION_ALPHA]=t,r))},blendEquationSeparate:function(e,t,r){var n;return e(((n={})[f.GL.BLEND_EQUATION_RGB]=t,n[f.GL.BLEND_EQUATION_ALPHA]=r,n))},blendFunc:function(e,t,r){var n;return e(((n={})[f.GL.BLEND_SRC_RGB]=t,n[f.GL.BLEND_DST_RGB]=r,n[f.GL.BLEND_SRC_ALPHA]=t,n[f.GL.BLEND_DST_ALPHA]=r,n))},blendFuncSeparate:function(e,t,r,n,i){var a;return e(((a={})[f.GL.BLEND_SRC_RGB]=t,a[f.GL.BLEND_DST_RGB]=r,a[f.GL.BLEND_SRC_ALPHA]=n,a[f.GL.BLEND_DST_ALPHA]=i,a))},clearColor:function(e,t,r,n,i){var a;return e(((a={})[f.GL.COLOR_CLEAR_VALUE]=new Float32Array([t,r,n,i]),a))},clearDepth:function(e,t){var r;return e(((r={})[f.GL.DEPTH_CLEAR_VALUE]=t,r))},clearStencil:function(e,t){var r;return e(((r={})[f.GL.STENCIL_CLEAR_VALUE]=t,r))},colorMask:function(e,t,r,n,i){var a;return e(((a={})[f.GL.COLOR_WRITEMASK]=[t,r,n,i],a))},cullFace:function(e,t){var r;return e(((r={})[f.GL.CULL_FACE_MODE]=t,r))},depthFunc:function(e,t){var r;return e(((r={})[f.GL.DEPTH_FUNC]=t,r))},depthRange:function(e,t,r){var n;return e(((n={})[f.GL.DEPTH_RANGE]=new Float32Array([t,r]),n))},depthMask:function(e,t){var r;return e(((r={})[f.GL.DEPTH_WRITEMASK]=t,r))},frontFace:function(e,t){var r;return e(((r={})[f.GL.FRONT_FACE]=t,r))},lineWidth:function(e,t){var r;return e(((r={})[f.GL.LINE_WIDTH]=t,r))},polygonOffset:function(e,t,r){var n;return e(((n={})[f.GL.POLYGON_OFFSET_FACTOR]=t,n[f.GL.POLYGON_OFFSET_UNITS]=r,n))},sampleCoverage:function(e,t,r){var n;return e(((n={})[f.GL.SAMPLE_COVERAGE_VALUE]=t,n[f.GL.SAMPLE_COVERAGE_INVERT]=r,n))},scissor:function(e,t,r,n,i){var a;return e(((a={})[f.GL.SCISSOR_BOX]=new Int32Array([t,r,n,i]),a))},stencilMask:function(e,t){var r;return e(((r={})[f.GL.STENCIL_WRITEMASK]=t,r[f.GL.STENCIL_BACK_WRITEMASK]=t,r))},stencilMaskSeparate:function(e,t,r){var n;return e(((n={})[t===f.GL.FRONT?f.GL.STENCIL_WRITEMASK:f.GL.STENCIL_BACK_WRITEMASK]=r,n))},stencilFunc:function(e,t,r,n){var i;return e(((i={})[f.GL.STENCIL_FUNC]=t,i[f.GL.STENCIL_REF]=r,i[f.GL.STENCIL_VALUE_MASK]=n,i[f.GL.STENCIL_BACK_FUNC]=t,i[f.GL.STENCIL_BACK_REF]=r,i[f.GL.STENCIL_BACK_VALUE_MASK]=n,i))},stencilFuncSeparate:function(e,t,r,n,i){var a;return e(((a={})[t===f.GL.FRONT?f.GL.STENCIL_FUNC:f.GL.STENCIL_BACK_FUNC]=r,a[t===f.GL.FRONT?f.GL.STENCIL_REF:f.GL.STENCIL_BACK_REF]=n,a[t===f.GL.FRONT?f.GL.STENCIL_VALUE_MASK:f.GL.STENCIL_BACK_VALUE_MASK]=i,a))},stencilOp:function(e,t,r,n){var i;return e(((i={})[f.GL.STENCIL_FAIL]=t,i[f.GL.STENCIL_PASS_DEPTH_FAIL]=r,i[f.GL.STENCIL_PASS_DEPTH_PASS]=n,i[f.GL.STENCIL_BACK_FAIL]=t,i[f.GL.STENCIL_BACK_PASS_DEPTH_FAIL]=r,i[f.GL.STENCIL_BACK_PASS_DEPTH_PASS]=n,i))},stencilOpSeparate:function(e,t,r,n,i){var a;return e(((a={})[t===f.GL.FRONT?f.GL.STENCIL_FAIL:f.GL.STENCIL_BACK_FAIL]=r,a[t===f.GL.FRONT?f.GL.STENCIL_PASS_DEPTH_FAIL:f.GL.STENCIL_BACK_PASS_DEPTH_FAIL]=n,a[t===f.GL.FRONT?f.GL.STENCIL_PASS_DEPTH_PASS:f.GL.STENCIL_BACK_PASS_DEPTH_PASS]=i,a))},viewport:function(e,t,r,n,i){var a;return e(((a={})[f.GL.VIEWPORT]=[t,r,n,i],a))}},R=function(e,t){return e.isEnabled(t)},T=((s={})[f.GL.BLEND]=R,s[f.GL.CULL_FACE]=R,s[f.GL.DEPTH_TEST]=R,s[f.GL.DITHER]=R,s[f.GL.POLYGON_OFFSET_FILL]=R,s[f.GL.SAMPLE_ALPHA_TO_COVERAGE]=R,s[f.GL.SAMPLE_COVERAGE]=R,s[f.GL.SCISSOR_TEST]=R,s[f.GL.STENCIL_TEST]=R,s[f.GL.RASTERIZER_DISCARD]=R,s),b=new Set([f.GL.ACTIVE_TEXTURE,f.GL.TRANSFORM_FEEDBACK_ACTIVE,f.GL.TRANSFORM_FEEDBACK_PAUSED,f.GL.TRANSFORM_FEEDBACK_BUFFER_BINDING,f.GL.UNIFORM_BUFFER_BINDING,f.GL.ELEMENT_ARRAY_BUFFER_BINDING,f.GL.IMPLEMENTATION_COLOR_READ_FORMAT,f.GL.IMPLEMENTATION_COLOR_READ_TYPE,f.GL.READ_BUFFER,f.GL.DRAW_BUFFER0,f.GL.DRAW_BUFFER1,f.GL.DRAW_BUFFER2,f.GL.DRAW_BUFFER3,f.GL.DRAW_BUFFER4,f.GL.DRAW_BUFFER5,f.GL.DRAW_BUFFER6,f.GL.DRAW_BUFFER7,f.GL.DRAW_BUFFER8,f.GL.DRAW_BUFFER9,f.GL.DRAW_BUFFER10,f.GL.DRAW_BUFFER11,f.GL.DRAW_BUFFER12,f.GL.DRAW_BUFFER13,f.GL.DRAW_BUFFER14,f.GL.DRAW_BUFFER15,f.GL.SAMPLER_BINDING,f.GL.TEXTURE_BINDING_2D,f.GL.TEXTURE_BINDING_2D_ARRAY,f.GL.TEXTURE_BINDING_3D,f.GL.TEXTURE_BINDING_CUBE_MAP]);function S(e,t){if(!function(e){for(var t in e)return!1;return!0}(t)){var r={};for(var n in t){var i=Number(n),a=m[n];a&&("string"==typeof a?r[a]=!0:a(e,t[n],i))}var s=e.state&&e.state.cache;if(s)for(var o in r){(0,A[o])(e,t,s)}}}function C(e,t){if(void 0===t&&(t=h),"number"==typeof t){var r=t,n=T[r];return n?n(e,r):e.getParameter(r)}for(var i,a=Array.isArray(t)?t:Object.keys(t),s={},o=(0,l.A)(a);!(i=o()).done;){var u=i.value,c=T[u];s[u]=c?c(e,Number(u)):e.getParameter(Number(u))}return s}function N(e,t){if(e===t)return!0;if(y(e)&&y(t)&&e.length===t.length){for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}return!1}function y(e){return Array.isArray(e)||ArrayBuffer.isView(e)}var I=function(){function e(e,t){this.program=null,this.stateStack=[],this.enable=!0,this.cache=null,this.initialized=!1,this.gl=e,this.log=(null==t?void 0:t.log)||function(){},this._updateCache=this._updateCache.bind(this),Object.seal(this)}e.get=function(e){return e.state};var t=e.prototype;return t.push=function(e){void 0===e&&(e={}),this.stateStack.push({})},t.pop=function(){var e=this.stateStack[this.stateStack.length-1];S(this.gl,e),this.stateStack.pop()},t.trackState=function(e,t){if(this.cache=null!=t&&t.copyState?C(e):Object.assign({},h),this.initialized)throw new Error("WebGLStateTracker");for(var r in this.initialized=!0,this.gl.state=this,B(e),v){P(e,r,v[r])}F(e,"getParameter"),F(e,"isEnabled")},t._updateCache=function(e){var t,r=!1,n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(var i in e){var a=e[i],s=this.cache[i];N(a,s)||(r=!0,t=s,n&&!(i in n)&&(n[i]=s),this.cache[i]=a)}return{valueChanged:r,oldValue:t}},e}();function F(e,t){var r=e[t].bind(e);e[t]=function(t){if(void 0===t||b.has(t))return r(t);var n=I.get(e);return t in n.cache||(n.cache[t]=r(t)),n.enable?n.cache[t]:r(t)},Object.defineProperty(e[t],"name",{value:t+"-from-cache",configurable:!1})}function P(e,t,r){if(e[t]){var n=e[t].bind(e);e[t]=function(){for(var t=I.get(e),i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];var o=r.apply(void 0,[t._updateCache].concat(a)),u=o.valueChanged,c=o.oldValue;return u&&n.apply(void 0,a),c},Object.defineProperty(e[t],"name",{value:t+"-to-cache",configurable:!1})}}function B(e){var t=e.useProgram.bind(e);e.useProgram=function(r){var n=I.get(e);n.program!==r&&(t(r),n.program=r)}}function O(e,t,r){return void 0===r[t]&&(r[t]=e.getExtension(t)||null),r[t]}function D(e,t){var r=e.getParameter(f.GL.VENDOR),n=e.getParameter(f.GL.RENDERER);O(e,"WEBGL_debug_renderer_info",t);var i=t.WEBGL_debug_renderer_info,a=e.getParameter(i?i.UNMASKED_VENDOR_WEBGL:f.GL.VENDOR)||r,s=e.getParameter(i?i.UNMASKED_RENDERER_WEBGL:f.GL.RENDERER)||n,o=e.getParameter(f.GL.VERSION),u=x(a,s),c=function(e,t){if(/Metal/i.exec(e)||/Metal/i.exec(t))return"metal";if(/ANGLE/i.exec(e)||/ANGLE/i.exec(t))return"opengl";return"unknown"}(a,s),l=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(x(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(a,s);return{type:"webgl",gpu:u,gpuType:l,gpuBackend:c,vendor:a,renderer:s,version:o,shadingLanguage:"glsl",shadingLanguageVersion:300}}function x(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}var w=r(2444),M=r(116);function U(e){switch(e){case"uint8":case"unorm8":return f.GL.UNSIGNED_BYTE;case"sint8":case"snorm8":return f.GL.BYTE;case"uint16":case"unorm16":return f.GL.UNSIGNED_SHORT;case"sint16":case"snorm16":return f.GL.SHORT;case"uint32":return f.GL.UNSIGNED_INT;case"sint32":return f.GL.INT;case"float16":return f.GL.HALF_FLOAT;case"float32":return f.GL.FLOAT}throw new Error(String(e))}var W="WEBGL_compressed_texture_s3tc",k="WEBGL_compressed_texture_s3tc_srgb",H="EXT_texture_compression_rgtc",K="EXT_texture_compression_bptc",V="EXT_texture_norm16",X="EXT_render_snorm",z={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[X],"norm16-renderable-webgl":[V],"snorm16-renderable-webgl":[V,X],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[W,k,H,K],"texture-compression-bc5-webgl":[H],"texture-compression-bc7-webgl":[K],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]};var Y={r8unorm:{gl:f.GL.R8,rb:!0},r8snorm:{gl:f.GL.R8_SNORM},r8uint:{gl:f.GL.R8UI,rb:!0},r8sint:{gl:f.GL.R8I,rb:!0},rg8unorm:{gl:f.GL.RG8,rb:!0},rg8snorm:{gl:f.GL.RG8_SNORM},rg8uint:{gl:f.GL.RG8UI,rb:!0},rg8sint:{gl:f.GL.RG8I,rb:!0},r16uint:{gl:f.GL.R16UI,rb:!0},r16sint:{gl:f.GL.R16I,rb:!0},r16float:{gl:f.GL.R16F,rb:!0},r16unorm:{gl:f.GL.R16_EXT,rb:!0},r16snorm:{gl:f.GL.R16_SNORM_EXT},"rgba4unorm-webgl":{gl:f.GL.RGBA4,rb:!0},"rgb565unorm-webgl":{gl:f.GL.RGB565,rb:!0},"rgb5a1unorm-webgl":{gl:f.GL.RGB5_A1,rb:!0},"rgb8unorm-webgl":{gl:f.GL.RGB8},"rgb8snorm-webgl":{gl:f.GL.RGB8_SNORM},rgba8unorm:{gl:f.GL.RGBA8},"rgba8unorm-srgb":{gl:f.GL.SRGB8_ALPHA8},rgba8snorm:{gl:f.GL.RGBA8_SNORM},rgba8uint:{gl:f.GL.RGBA8UI},rgba8sint:{gl:f.GL.RGBA8I},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:f.GL.RG16UI},rg16sint:{gl:f.GL.RG16I},rg16float:{gl:f.GL.RG16F,rb:!0},rg16unorm:{gl:f.GL.RG16_EXT},rg16snorm:{gl:f.GL.RG16_SNORM_EXT},r32uint:{gl:f.GL.R32UI,rb:!0},r32sint:{gl:f.GL.R32I,rb:!0},r32float:{gl:f.GL.R32F},rgb9e5ufloat:{gl:f.GL.RGB9_E5},rg11b10ufloat:{gl:f.GL.R11F_G11F_B10F,rb:!0},rgb10a2unorm:{gl:f.GL.RGB10_A2,rb:!0},rgb10a2uint:{gl:f.GL.RGB10_A2UI,rb:!0},"rgb16unorm-webgl":{gl:f.GL.RGB16_EXT},"rgb16snorm-webgl":{gl:f.GL.RGB16_SNORM_EXT},rg32uint:{gl:f.GL.RG32UI,rb:!0},rg32sint:{gl:f.GL.RG32I,rb:!0},rg32float:{gl:f.GL.RG32F,rb:!0},rgba16uint:{gl:f.GL.RGBA16UI,rb:!0},rgba16sint:{gl:f.GL.RGBA16I,rb:!0},rgba16float:{gl:f.GL.RGBA16F},rgba16unorm:{gl:f.GL.RGBA16_EXT,rb:!0},rgba16snorm:{gl:f.GL.RGBA16_SNORM_EXT},"rgb32float-webgl":{gl:f.GL.RGB32F,x:"EXT_color_buffer_float",dataFormat:f.GL.RGB,types:[f.GL.FLOAT]},rgba32uint:{gl:f.GL.RGBA32UI,rb:!0},rgba32sint:{gl:f.GL.RGBA32I,rb:!0},rgba32float:{gl:f.GL.RGBA32F,rb:!0},stencil8:{gl:f.GL.STENCIL_INDEX8,rb:!0},depth16unorm:{gl:f.GL.DEPTH_COMPONENT16,dataFormat:f.GL.DEPTH_COMPONENT,types:[f.GL.UNSIGNED_SHORT],rb:!0},depth24plus:{gl:f.GL.DEPTH_COMPONENT24,dataFormat:f.GL.DEPTH_COMPONENT,types:[f.GL.UNSIGNED_INT]},depth32float:{gl:f.GL.DEPTH_COMPONENT32F,dataFormat:f.GL.DEPTH_COMPONENT,types:[f.GL.FLOAT],rb:!0},"depth24plus-stencil8":{gl:f.GL.DEPTH24_STENCIL8,rb:!0,depthTexture:!0,dataFormat:f.GL.DEPTH_STENCIL,types:[f.GL.UNSIGNED_INT_24_8]},"depth32float-stencil8":{gl:f.GL.DEPTH32F_STENCIL8,dataFormat:f.GL.DEPTH_STENCIL,types:[f.GL.FLOAT_32_UNSIGNED_INT_24_8_REV],rb:!0},"bc1-rgb-unorm-webgl":{gl:f.GL.COMPRESSED_RGB_S3TC_DXT1_EXT,x:W},"bc1-rgb-unorm-srgb-webgl":{gl:f.GL.COMPRESSED_SRGB_S3TC_DXT1_EXT,x:k},"bc1-rgba-unorm":{gl:f.GL.COMPRESSED_RGBA_S3TC_DXT1_EXT,x:W},"bc1-rgba-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB_S3TC_DXT1_EXT,x:k},"bc2-rgba-unorm":{gl:f.GL.COMPRESSED_RGBA_S3TC_DXT3_EXT,x:W},"bc2-rgba-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,x:k},"bc3-rgba-unorm":{gl:f.GL.COMPRESSED_RGBA_S3TC_DXT5_EXT,x:W},"bc3-rgba-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,x:k},"bc4-r-unorm":{gl:f.GL.COMPRESSED_RED_RGTC1_EXT,x:H},"bc4-r-snorm":{gl:f.GL.COMPRESSED_SIGNED_RED_RGTC1_EXT,x:H},"bc5-rg-unorm":{gl:f.GL.COMPRESSED_RED_GREEN_RGTC2_EXT,x:H},"bc5-rg-snorm":{gl:f.GL.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,x:H},"bc6h-rgb-ufloat":{gl:f.GL.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,x:K},"bc6h-rgb-float":{gl:f.GL.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,x:K},"bc7-rgba-unorm":{gl:f.GL.COMPRESSED_RGBA_BPTC_UNORM_EXT,x:K},"bc7-rgba-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT,x:K},"etc2-rgb8unorm":{gl:f.GL.COMPRESSED_RGB8_ETC2},"etc2-rgb8unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ETC2},"etc2-rgb8a1unorm":{gl:f.GL.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2},"etc2-rgb8a1unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2},"etc2-rgba8unorm":{gl:f.GL.COMPRESSED_RGBA8_ETC2_EAC},"etc2-rgba8unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC},"eac-r11unorm":{gl:f.GL.COMPRESSED_R11_EAC},"eac-r11snorm":{gl:f.GL.COMPRESSED_SIGNED_R11_EAC},"eac-rg11unorm":{gl:f.GL.COMPRESSED_RG11_EAC},"eac-rg11snorm":{gl:f.GL.COMPRESSED_SIGNED_RG11_EAC},"astc-4x4-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_4x4_KHR},"astc-4x4-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR},"astc-5x4-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_5x4_KHR},"astc-5x4-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR},"astc-5x5-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_5x5_KHR},"astc-5x5-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR},"astc-6x5-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_6x5_KHR},"astc-6x5-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR},"astc-6x6-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_6x6_KHR},"astc-6x6-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR},"astc-8x5-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_8x5_KHR},"astc-8x5-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR},"astc-8x6-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_8x6_KHR},"astc-8x6-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR},"astc-8x8-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_8x8_KHR},"astc-8x8-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR},"astc-10x5-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_10x10_KHR},"astc-10x5-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR},"astc-10x6-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_10x6_KHR},"astc-10x6-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR},"astc-10x8-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_10x8_KHR},"astc-10x8-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR},"astc-10x10-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_10x10_KHR},"astc-10x10-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR},"astc-12x10-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_12x10_KHR},"astc-12x10-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR},"astc-12x12-unorm":{gl:f.GL.COMPRESSED_RGBA_ASTC_12x12_KHR},"astc-12x12-unorm-srgb":{gl:f.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR},"pvrtc-rgb4unorm-webgl":{gl:f.GL.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc-rgba4unorm-webgl":{gl:f.GL.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"pvrtc-rbg2unorm-webgl":{gl:f.GL.COMPRESSED_RGB_PVRTC_2BPPV1_IMG},"pvrtc-rgba2unorm-webgl":{gl:f.GL.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG},"etc1-rbg-unorm-webgl":{gl:f.GL.COMPRESSED_RGB_ETC1_WEBGL},"atc-rgb-unorm-webgl":{gl:f.GL.COMPRESSED_RGB_ATC_WEBGL},"atc-rgba-unorm-webgl":{gl:f.GL.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL},"atc-rgbai-unorm-webgl":{gl:f.GL.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL}};function j(e){var t,r=Y[e],n=function(e){var t=Y[e],r=null==t?void 0:t.gl;if(void 0===r)throw new Error("Unsupported texture format "+e);return r}(e),i=M.vz.getInfo(e);return i.compressed&&(r.dataFormat=n),{internalFormat:n,format:(null==r?void 0:r.dataFormat)||Q(i.channels,i.integer,i.normalized,n),type:i.dataType?U(i.dataType):(null==r||null==(t=r.types)?void 0:t[0])||f.GL.UNSIGNED_BYTE,compressed:i.compressed||!1}}function Q(e,t,r,n){if(n===f.GL.RGBA||n===f.GL.RGB)return n;switch(e){case"r":return t&&!r?f.GL.RED_INTEGER:f.GL.RED;case"rg":return t&&!r?f.GL.RG_INTEGER:f.GL.RG;case"rgb":return t&&!r?f.GL.RGB_INTEGER:f.GL.RGB;case"rgba":return t&&!r?f.GL.RGBA_INTEGER:f.GL.RGBA;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return f.GL.RGBA}}var q={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},Z=function(e){function t(t,r,n){var i;return(i=e.call(this,[],n)||this).testedFeatures=new Set,i.gl=t,i.extensions=r,O(t,"EXT_color_buffer_float",r),i}(0,o.A)(t,e);var r=t.prototype;return r[Symbol.iterator]=(0,w.A)().m(function e(){var t,r,n,i;return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:t=this.getFeatures(),r=(0,l.A)(t);case 1:if((n=r()).done){e.n=3;break}if(i=n.value,!this.has(i)){e.n=2;break}return e.n=2,i;case 2:e.n=1;break;case 3:return e.a(2,[])}},e,this)}),r.has=function(e){var t;return(null==(t=this.disabledFeatures)||!t[e])&&(this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in z}(e)&&function(e,t,r){return(z[t]||[]).every(function(t){return O(e,t,r)})}(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))},r.initializeFeatures=function(){for(var e,t=this.getFeatures().filter(function(e){return"polygon-mode-webgl"!==e}),r=(0,l.A)(t);!(e=r()).done;){var n=e.value;this.has(n)}},r.getFeatures=function(){return[].concat(Object.keys(q),Object.keys(z))},r.getWebGLFeature=function(e){var t=q[e];return"string"==typeof t?Boolean(O(this.gl,t,this.extensions)):Boolean(t)},t}(u.I7),J=function(e){function t(t){var r;return(r=e.call(this)||this).limits={},r.gl=t,r}return(0,o.A)(t,e),t.prototype.getParameter=function(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0},(0,n.A)(t,[{key:"maxTextureDimension1D",get:function(){return 0}},{key:"maxTextureDimension2D",get:function(){return this.getParameter(f.GL.MAX_TEXTURE_SIZE)}},{key:"maxTextureDimension3D",get:function(){return this.getParameter(f.GL.MAX_3D_TEXTURE_SIZE)}},{key:"maxTextureArrayLayers",get:function(){return this.getParameter(f.GL.MAX_ARRAY_TEXTURE_LAYERS)}},{key:"maxBindGroups",get:function(){return 0}},{key:"maxDynamicUniformBuffersPerPipelineLayout",get:function(){return 0}},{key:"maxDynamicStorageBuffersPerPipelineLayout",get:function(){return 0}},{key:"maxSampledTexturesPerShaderStage",get:function(){return this.getParameter(f.GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}},{key:"maxSamplersPerShaderStage",get:function(){return this.getParameter(f.GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS)}},{key:"maxStorageBuffersPerShaderStage",get:function(){return 0}},{key:"maxStorageTexturesPerShaderStage",get:function(){return 0}},{key:"maxUniformBuffersPerShaderStage",get:function(){return this.getParameter(f.GL.MAX_UNIFORM_BUFFER_BINDINGS)}},{key:"maxUniformBufferBindingSize",get:function(){return this.getParameter(f.GL.MAX_UNIFORM_BLOCK_SIZE)}},{key:"maxStorageBufferBindingSize",get:function(){return 0}},{key:"minUniformBufferOffsetAlignment",get:function(){return this.getParameter(f.GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT)}},{key:"minStorageBufferOffsetAlignment",get:function(){return 0}},{key:"maxVertexBuffers",get:function(){return 16}},{key:"maxVertexAttributes",get:function(){return this.getParameter(f.GL.MAX_VERTEX_ATTRIBS)}},{key:"maxVertexBufferArrayStride",get:function(){return 2048}},{key:"maxInterStageShaderVariables",get:function(){return this.getParameter(f.GL.MAX_VARYING_COMPONENTS)}},{key:"maxComputeWorkgroupStorageSize",get:function(){return 0}},{key:"maxComputeInvocationsPerWorkgroup",get:function(){return 0}},{key:"maxComputeWorkgroupSizeX",get:function(){return 0}},{key:"maxComputeWorkgroupSizeY",get:function(){return 0}},{key:"maxComputeWorkgroupSizeZ",get:function(){return 0}},{key:"maxComputeWorkgroupsPerDimension",get:function(){return 0}}])}(u.PI),$=r(3956),ee=r(1243),te=function(e){function t(t,r){var n;(n=e.call(this,t,r)||this).colorAttachments=[],n.depthStencilAttachment=null;var i=null===r.handle;return n.device=t,n.gl=t.gl,n.handle=n.props.handle||i?n.props.handle:n.gl.createFramebuffer(),i||(t._setWebGLDebugMetadata(n.handle,n,{spector:n.props}),n.autoCreateAttachmentTextures(),n.updateAttachments()),n}(0,o.A)(t,e);var r=t.prototype;return r.destroy=function(){e.prototype.destroy.call(this),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)},r.updateAttachments=function(){for(var e=this.gl.bindFramebuffer(f.GL.FRAMEBUFFER,this.handle),t=0;t<this.colorAttachments.length;++t){var r=this.colorAttachments[t];if(r){var n=f.GL.COLOR_ATTACHMENT0+t;this._attachTextureView(n,r)}}if(this.depthStencilAttachment){var i=function(e){switch(M.vz.getInfo(e).attachment){case"depth":return f.GL.DEPTH_ATTACHMENT;case"stencil":return f.GL.STENCIL_ATTACHMENT;case"depth-stencil":return f.GL.DEPTH_STENCIL_ATTACHMENT;default:throw new Error("Not a depth stencil format: "+e)}}(this.depthStencilAttachment.props.format);this._attachTextureView(i,this.depthStencilAttachment)}if(this.device.props.debug){var a=this.gl.checkFramebufferStatus(f.GL.FRAMEBUFFER);if(a!==f.GL.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer "+function(e){switch(e){case f.GL.FRAMEBUFFER_COMPLETE:return"success";case f.GL.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Mismatched attachments";case f.GL.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"No attachments";case f.GL.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"Height/width mismatch";case f.GL.FRAMEBUFFER_UNSUPPORTED:return"Unsupported or split attachments";case f.GL.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"Samples mismatch";default:return""+e}}(a))}this.gl.bindFramebuffer(f.GL.FRAMEBUFFER,e)},r._attachTextureView=function(e,t){var r=this.device.gl,n=t.texture,i=t.props.baseMipLevel,a=t.props.baseArrayLayer;switch(r.bindTexture(n.glTarget,n.handle),n.glTarget){case f.GL.TEXTURE_2D_ARRAY:case f.GL.TEXTURE_3D:r.framebufferTextureLayer(f.GL.FRAMEBUFFER,e,n.handle,i,a);break;case f.GL.TEXTURE_CUBE_MAP:var s=function(e){return e<f.GL.TEXTURE_CUBE_MAP_POSITIVE_X?e+f.GL.TEXTURE_CUBE_MAP_POSITIVE_X:e}(a);r.framebufferTexture2D(f.GL.FRAMEBUFFER,e,s,n.handle,i);break;case f.GL.TEXTURE_2D:r.framebufferTexture2D(f.GL.FRAMEBUFFER,e,f.GL.TEXTURE_2D,n.handle,i);break;default:throw new Error("Illegal texture type")}r.bindTexture(n.glTarget,null)},t}(ee.G);var re=function(e){function t(t,r){var n;return(n=e.call(this,r)||this).handle=null,n._framebuffer=null,n.device=t,n._setAutoCreatedCanvasId(n.device.id+"-canvas"),n._configureDevice(),n}(0,o.A)(t,e);var r=t.prototype;return r._configureDevice=function(){var e,t,r;this.drawingBufferWidth===(null==(e=this._framebuffer)?void 0:e.width)&&this.drawingBufferHeight===(null==(t=this._framebuffer)?void 0:t.height)||(null==(r=this._framebuffer)||r.resize([this.drawingBufferWidth,this.drawingBufferHeight]))},r._getCurrentFramebuffer=function(){return this._framebuffer||(this._framebuffer=new te(this.device,{id:"canvas-context-framebuffer",handle:null,width:this.drawingBufferWidth,height:this.drawingBufferHeight})),this._framebuffer},(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"WebGLCanvasContext"}}])}($.Q),ne=r(7528),ie=r(3492),ae={};var se=r(467),oe=r(5056),ue=function(e){function t(t,r){var n;void 0===r&&(r={}),(n=e.call(this,t,r)||this).glIndexType=f.GL.UNSIGNED_SHORT,n.byteLength=0,n.bytesUsed=0,n.device=t,n.gl=n.device.gl;var i="object"==typeof r?r.handle:void 0;return n.handle=i||n.gl.createBuffer(),t._setWebGLDebugMetadata(n.handle,n,{spector:Object.assign({},n.props,{data:typeof n.props.data})}),n.glTarget=function(e){if(e&oe.h.INDEX)return f.GL.ELEMENT_ARRAY_BUFFER;if(e&oe.h.VERTEX)return f.GL.ARRAY_BUFFER;if(e&oe.h.UNIFORM)return f.GL.UNIFORM_BUFFER;return f.GL.ARRAY_BUFFER}(n.props.usage),n.glUsage=function(e){if(e&oe.h.INDEX)return f.GL.STATIC_DRAW;if(e&oe.h.VERTEX)return f.GL.STATIC_DRAW;if(e&oe.h.UNIFORM)return f.GL.DYNAMIC_DRAW;return f.GL.STATIC_DRAW}(n.props.usage),n.glIndexType="uint32"===n.props.indexType?f.GL.UNSIGNED_INT:f.GL.UNSIGNED_SHORT,r.data?n._initWithData(r.data,r.byteOffset,r.byteLength):n._initWithByteLength(r.byteLength||0),n}(0,o.A)(t,e);var r=t.prototype;return r.destroy=function(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)},r._initWithData=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.byteLength+t);var n=this.glTarget;this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(e,t,r),this.trackAllocatedMemory(r)},r._initWithByteLength=function(e){var t=e;0===e&&(t=new Float32Array(0));var r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,t,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this},r.write=function(e,t){void 0===t&&(t=0);var r=ArrayBuffer.isView(e)?e:new Uint8Array(e),n=f.GL.COPY_WRITE_BUFFER;this.gl.bindBuffer(n,this.handle),this.gl.bufferSubData(n,t,r),this.gl.bindBuffer(n,null),this._setDebugData(e,t,e.byteLength)},r.mapAndWriteAsync=function(){var e=(0,se.A)((0,w.A)().m(function e(t,r,n){var i;return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:return void 0===r&&(r=0),void 0===n&&(n=this.byteLength-r),i=new ArrayBuffer(n),e.n=1,t(i,"copied");case 1:this.write(i,r);case 2:return e.a(2)}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),r.readAsync=function(){var e=(0,se.A)((0,w.A)().m(function e(t,r){return(0,w.A)().w(function(e){for(;;)if(0===e.n)return void 0===t&&(t=0),e.a(2,this.readSyncWebGL(t,r))},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),r.mapAndReadAsync=function(){var e=(0,se.A)((0,w.A)().m(function e(t,r,n){var i;return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:return void 0===r&&(r=0),e.n=1,this.readAsync(r,n);case 1:return i=e.v,e.n=2,t(i.buffer,"copied");case 2:return e.a(2,e.v)}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),r.readSyncWebGL=function(e,t){void 0===e&&(e=0),t=null!=t?t:this.byteLength-e;var r=new Uint8Array(t);return this.gl.bindBuffer(f.GL.COPY_READ_BUFFER,this.handle),this.gl.getBufferSubData(f.GL.COPY_READ_BUFFER,e,r,0,t),this.gl.bindBuffer(f.GL.COPY_READ_BUFFER,null),this._setDebugData(r,e,t),r},t}(oe.h);function ce(e){var t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}var le=function(e){function t(t,r){var n;switch((n=e.call(this,t,r)||this).device=t,n.props.stage){case"vertex":n.handle=n.props.handle||n.device.gl.createShader(f.GL.VERTEX_SHADER);break;case"fragment":n.handle=n.props.handle||n.device.gl.createShader(f.GL.FRAGMENT_SHADER);break;default:throw new Error(n.props.stage)}return t._setWebGLDebugMetadata(n.handle,n,{spector:n.props}),n._compile(n.source),n}(0,o.A)(t,e);var r=t.prototype;return r.destroy=function(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)},r.getCompilationInfo=function(){var e=(0,se.A)((0,w.A)().m(function e(){return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._waitForCompilationComplete();case 1:return e.a(2,this.getCompilationInfoSync())}},e,this)}));return function(){return e.apply(this,arguments)}}(),r.getCompilationInfoSync=function(){var e=this.device.gl.getShaderInfoLog(this.handle);return e?function(e){for(var t,r=e.split(/\r?\n/),n=[],i=(0,l.A)(r);!(t=i()).done;){var a=t.value;if(!(a.length<=1)){var s=a.split(":");if(2!==s.length){var o=s[0],u=s[1],c=s[2],f=s.slice(3),h=parseInt(c,10);isNaN(h)&&(h=0);var d=parseInt(u,10);isNaN(d)&&(d=0),n.push({message:f.join(":").trim(),type:ce(o),lineNum:h,linePos:d})}else{var _=s[0],L=s[1];n.push({message:L.trim(),type:ce(_),lineNum:0,linePos:0})}}}return n}(e):[]},r.getTranslatedSource=function(){var e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(null==e?void 0:e.getTranslatedShaderSource(this.handle))||null},r._compile=function(){var e=(0,se.A)((0,w.A)().m(function e(t){var r;return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:if(t=t.startsWith("#version ")?t:"#version 300 es\n"+t,(r=this.device.gl).shaderSource(this.handle,t),r.compileShader(this.handle),this.device.props.debug){e.n=1;break}return this.compilationStatus="pending",e.a(2);case 1:if(this.device.features.has("compilation-status-async-webgl")){e.n=3;break}if(this._getCompilationStatus(),this.debugShader(),"error"!==this.compilationStatus){e.n=2;break}throw new Error("GLSL compilation errors in "+this.props.stage+" shader "+this.props.id);case 2:return e.a(2);case 3:return c.R.once(1,"Shader compilation is asynchronous")(),e.n=4,this._waitForCompilationComplete();case 4:c.R.info(2,"Shader "+this.id+" - async compilation complete: "+this.compilationStatus)(),this._getCompilationStatus(),this.debugShader();case 5:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r._waitForCompilationComplete=function(){var e=(0,se.A)((0,w.A)().m(function e(){var t,r,n;return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:if(t=function(){var e=(0,se.A)((0,w.A)().m(function e(t){return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,new Promise(function(e){return setTimeout(e,t)});case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),r=10,this.device.features.has("compilation-status-async-webgl")){e.n=2;break}return e.n=1,t(r);case 1:return e.a(2);case 2:n=this.device.gl;case 3:if(!n.getShaderParameter(this.handle,f.GL.COMPLETION_STATUS_KHR)){e.n=4;break}return e.a(2);case 4:return e.n=5,t(r);case 5:e.n=3;break;case 6:return e.a(2)}},e,this)}));return function(){return e.apply(this,arguments)}}(),r._getCompilationStatus=function(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,f.GL.COMPILE_STATUS)?"success":"error"},(0,n.A)(t,[{key:"asyncCompilationStatus",get:function(){var e=this;return this._waitForCompilationComplete().then(function(){return e._getCompilationStatus(),e.compilationStatus})}}])}(r(7468).M);function fe(e,t){var r=e,n=r.gl;if(t.cullMode)switch(t.cullMode){case"none":n.disable(f.GL.CULL_FACE);break;case"front":n.enable(f.GL.CULL_FACE),n.cullFace(f.GL.FRONT);break;case"back":n.enable(f.GL.CULL_FACE),n.cullFace(f.GL.BACK)}if(t.frontFace&&n.frontFace(Ee("frontFace",t.frontFace,{ccw:f.GL.CCW,cw:f.GL.CW})),t.unclippedDepth&&e.features.has("depth-clip-control")&&n.enable(f.GL.DEPTH_CLAMP_EXT),void 0!==t.depthBias&&(n.enable(f.GL.POLYGON_OFFSET_FILL),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){var i=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,a=Ee("provokingVertex",t.provokingVertex,{first:f.GL.FIRST_VERTEX_CONVENTION_WEBGL,last:f.GL.LAST_VERTEX_CONVENTION_WEBGL});null==i||i.provokingVertexWEBGL(a)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){var s=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Ee("polygonMode",t.polygonMode,{fill:f.GL.FILL_WEBGL,line:f.GL.LINE_WEBGL});null==s||s.polygonModeWEBGL(f.GL.FRONT,o),null==s||s.polygonModeWEBGL(f.GL.BACK,o)}t.polygonOffsetLine&&n.enable(f.GL.POLYGON_OFFSET_LINE_WEBGL)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(f.GL.CLIP_DISTANCE0_WEBGL),t.clipDistance1&&n.enable(f.GL.CLIP_DISTANCE1_WEBGL),t.clipDistance2&&n.enable(f.GL.CLIP_DISTANCE2_WEBGL),t.clipDistance3&&n.enable(f.GL.CLIP_DISTANCE3_WEBGL),t.clipDistance4&&n.enable(f.GL.CLIP_DISTANCE4_WEBGL),t.clipDistance5&&n.enable(f.GL.CLIP_DISTANCE5_WEBGL),t.clipDistance6&&n.enable(f.GL.CLIP_DISTANCE6_WEBGL),t.clipDistance7&&n.enable(f.GL.CLIP_DISTANCE7_WEBGL)),void 0!==t.depthWriteEnabled&&n.depthMask(t.depthWriteEnabled),t.depthCompare&&("always"!==t.depthCompare?n.enable(f.GL.DEPTH_TEST):n.disable(f.GL.DEPTH_TEST),n.depthFunc(he("depthCompare",t.depthCompare))),t.stencilWriteMask){var u=t.stencilWriteMask;n.stencilMaskSeparate(f.GL.FRONT,u),n.stencilMaskSeparate(f.GL.BACK,u)}if(t.stencilReadMask&&c.R.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){var l=t.stencilReadMask||4294967295,h=he("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?n.enable(f.GL.STENCIL_TEST):n.disable(f.GL.STENCIL_TEST),n.stencilFuncSeparate(f.GL.FRONT,h,0,l),n.stencilFuncSeparate(f.GL.BACK,h,0,l)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){var d=de("stencilPassOperation",t.stencilPassOperation),_=de("stencilFailOperation",t.stencilFailOperation),L=de("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(f.GL.FRONT,_,L,d),n.stencilOpSeparate(f.GL.BACK,_,L,d)}switch(t.blend){case!0:n.enable(f.GL.BLEND);break;case!1:n.disable(f.GL.BLEND)}if(t.blendColorOperation||t.blendAlphaOperation){var E=_e("blendColorOperation",t.blendColorOperation||"add"),g=_e("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(E,g);var p=Le("blendColorSrcFactor",t.blendColorSrcFactor||"one"),m=Le("blendColorDstFactor",t.blendColorDstFactor||"zero"),G=Le("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),A=Le("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(p,m,G,A)}}function he(e,t){return Ee(e,t,{never:f.GL.NEVER,less:f.GL.LESS,equal:f.GL.EQUAL,"less-equal":f.GL.LEQUAL,greater:f.GL.GREATER,"not-equal":f.GL.NOTEQUAL,"greater-equal":f.GL.GEQUAL,always:f.GL.ALWAYS})}function de(e,t){return Ee(e,t,{keep:f.GL.KEEP,zero:f.GL.ZERO,replace:f.GL.REPLACE,invert:f.GL.INVERT,"increment-clamp":f.GL.INCR,"decrement-clamp":f.GL.DECR,"increment-wrap":f.GL.INCR_WRAP,"decrement-wrap":f.GL.DECR_WRAP})}function _e(e,t){return Ee(e,t,{add:f.GL.FUNC_ADD,subtract:f.GL.FUNC_SUBTRACT,"reverse-subtract":f.GL.FUNC_REVERSE_SUBTRACT,min:f.GL.MIN,max:f.GL.MAX})}function Le(e,t,r){return void 0===r&&(r="color"),Ee(e,t,{one:f.GL.ONE,zero:f.GL.ZERO,src:f.GL.SRC_COLOR,"one-minus-src":f.GL.ONE_MINUS_SRC_COLOR,dst:f.GL.DST_COLOR,"one-minus-dst":f.GL.ONE_MINUS_DST_COLOR,"src-alpha":f.GL.SRC_ALPHA,"one-minus-src-alpha":f.GL.ONE_MINUS_SRC_ALPHA,"dst-alpha":f.GL.DST_ALPHA,"one-minus-dst-alpha":f.GL.ONE_MINUS_DST_ALPHA,"src-alpha-saturated":f.GL.SRC_ALPHA_SATURATE,constant:"color"===r?f.GL.CONSTANT_COLOR:f.GL.CONSTANT_ALPHA,"one-minus-constant":"color"===r?f.GL.ONE_MINUS_CONSTANT_COLOR:f.GL.ONE_MINUS_CONSTANT_ALPHA,src1:f.GL.SRC_COLOR,"one-minus-src1":f.GL.ONE_MINUS_SRC_COLOR,"src1-alpha":f.GL.SRC_ALPHA,"one-minus-src1-alpha":f.GL.ONE_MINUS_SRC_ALPHA})}function Ee(e,t,r){if(!(t in r))throw new Error(function(e,t){return"Illegal parameter "+t+" for "+e}(e,t));return r[t]}function ge(e){var t=!0;for(var r in e){t=!1;break}return t}function pe(e){var t={};return e.addressModeU&&(t[f.GL.TEXTURE_WRAP_S]=me(e.addressModeU)),e.addressModeV&&(t[f.GL.TEXTURE_WRAP_T]=me(e.addressModeV)),e.addressModeW&&(t[f.GL.TEXTURE_WRAP_R]=me(e.addressModeW)),e.magFilter&&(t[f.GL.TEXTURE_MAG_FILTER]=Ge(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[f.GL.TEXTURE_MIN_FILTER]=function(e,t){void 0===t&&(t="none");if(!t)return Ge(e);switch(t){case"none":return Ge(e);case"nearest":switch(e){case"nearest":return f.GL.NEAREST_MIPMAP_NEAREST;case"linear":return f.GL.LINEAR_MIPMAP_NEAREST}break;case"linear":switch(e){case"nearest":return f.GL.NEAREST_MIPMAP_LINEAR;case"linear":return f.GL.LINEAR_MIPMAP_LINEAR}}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[f.GL.TEXTURE_MIN_LOD]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[f.GL.TEXTURE_MAX_LOD]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[f.GL.TEXTURE_COMPARE_MODE]=f.GL.COMPARE_REF_TO_TEXTURE),e.compare&&(t[f.GL.TEXTURE_COMPARE_FUNC]=he("compare",e.compare)),e.maxAnisotropy&&(t[f.GL.TEXTURE_MAX_ANISOTROPY_EXT]=e.maxAnisotropy),t}function me(e){switch(e){case"clamp-to-edge":return f.GL.CLAMP_TO_EDGE;case"repeat":return f.GL.REPEAT;case"mirror-repeat":return f.GL.MIRRORED_REPEAT}}function Ge(e){switch(e){case"nearest":return f.GL.NEAREST;case"linear":return f.GL.LINEAR}}var Ae=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this).device=t,n.parameters=pe(r),n.handle=r.handle||n.device.gl.createSampler(),n._setSamplerParameters(n.parameters),n}(0,o.A)(t,e);var r=t.prototype;return r.destroy=function(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)},r.toString=function(){return"Sampler("+this.id+","+JSON.stringify(this.props)+")"},r._setSamplerParameters=function(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var n=r[t],i=n[0],a=n[1],s=Number(i);switch(s){case f.GL.TEXTURE_MIN_LOD:case f.GL.TEXTURE_MAX_LOD:this.device.gl.samplerParameterf(this.handle,s,a);break;default:this.device.gl.samplerParameteri(this.handle,s,a)}}},t}(r(5768).L),ve=r(454),Re=r(7083);function Te(e,t,r){if(function(e){for(var t in e)return!1;return!0}(t))return r(e);var n,i=t.nocatch,a=void 0===i||i,s=I.get(e);if(s.push(),S(e,t),a)n=r(e),s.pop();else try{n=r(e)}finally{s.pop()}return n}var be,Se,Ce,Ne=function(e){function t(t,r){var n;return(n=e.call(this,t,Object.assign({},Re.g.defaultProps,r))||this).device=t,n.gl=n.device.gl,n.handle=null,n.texture=r.texture,n}return(0,o.A)(t,e),t}(r(4353).X);function ye(e){return xe[e]}function Ie(e){return Oe[e]}function Fe(e){return Boolean(De[e])}function Pe(e){return De[e]}var Be,Oe=((be={})[f.GL.FLOAT]="f32",be[f.GL.FLOAT_VEC2]="vec2<f32>",be[f.GL.FLOAT_VEC3]="vec3<f32>",be[f.GL.FLOAT_VEC4]="vec4<f32>",be[f.GL.INT]="i32",be[f.GL.INT_VEC2]="vec2<i32>",be[f.GL.INT_VEC3]="vec3<i32>",be[f.GL.INT_VEC4]="vec4<i32>",be[f.GL.UNSIGNED_INT]="u32",be[f.GL.UNSIGNED_INT_VEC2]="vec2<u32>",be[f.GL.UNSIGNED_INT_VEC3]="vec3<u32>",be[f.GL.UNSIGNED_INT_VEC4]="vec4<u32>",be[f.GL.BOOL]="f32",be[f.GL.BOOL_VEC2]="vec2<f32>",be[f.GL.BOOL_VEC3]="vec3<f32>",be[f.GL.BOOL_VEC4]="vec4<f32>",be[f.GL.FLOAT_MAT2]="mat2x2<f32>",be[f.GL.FLOAT_MAT2x3]="mat2x3<f32>",be[f.GL.FLOAT_MAT2x4]="mat2x4<f32>",be[f.GL.FLOAT_MAT3x2]="mat3x2<f32>",be[f.GL.FLOAT_MAT3]="mat3x3<f32>",be[f.GL.FLOAT_MAT3x4]="mat3x4<f32>",be[f.GL.FLOAT_MAT4x2]="mat4x2<f32>",be[f.GL.FLOAT_MAT4x3]="mat4x3<f32>",be[f.GL.FLOAT_MAT4]="mat4x4<f32>",be),De=((Se={})[f.GL.SAMPLER_2D]={viewDimension:"2d",sampleType:"float"},Se[f.GL.SAMPLER_CUBE]={viewDimension:"cube",sampleType:"float"},Se[f.GL.SAMPLER_3D]={viewDimension:"3d",sampleType:"float"},Se[f.GL.SAMPLER_2D_SHADOW]={viewDimension:"3d",sampleType:"depth"},Se[f.GL.SAMPLER_2D_ARRAY]={viewDimension:"2d-array",sampleType:"float"},Se[f.GL.SAMPLER_2D_ARRAY_SHADOW]={viewDimension:"2d-array",sampleType:"depth"},Se[f.GL.SAMPLER_CUBE_SHADOW]={viewDimension:"cube",sampleType:"float"},Se[f.GL.INT_SAMPLER_2D]={viewDimension:"2d",sampleType:"sint"},Se[f.GL.INT_SAMPLER_3D]={viewDimension:"3d",sampleType:"sint"},Se[f.GL.INT_SAMPLER_CUBE]={viewDimension:"cube",sampleType:"sint"},Se[f.GL.INT_SAMPLER_2D_ARRAY]={viewDimension:"2d-array",sampleType:"uint"},Se[f.GL.UNSIGNED_INT_SAMPLER_2D]={viewDimension:"2d",sampleType:"uint"},Se[f.GL.UNSIGNED_INT_SAMPLER_3D]={viewDimension:"3d",sampleType:"uint"},Se[f.GL.UNSIGNED_INT_SAMPLER_CUBE]={viewDimension:"cube",sampleType:"uint"},Se[f.GL.UNSIGNED_INT_SAMPLER_2D_ARRAY]={viewDimension:"2d-array",sampleType:"uint"},Se),xe={uint8:f.GL.UNSIGNED_BYTE,sint8:f.GL.BYTE,unorm8:f.GL.UNSIGNED_BYTE,snorm8:f.GL.BYTE,uint16:f.GL.UNSIGNED_SHORT,sint16:f.GL.SHORT,unorm16:f.GL.UNSIGNED_SHORT,snorm16:f.GL.SHORT,uint32:f.GL.UNSIGNED_INT,sint32:f.GL.INT,float16:f.GL.HALF_FLOAT,float32:f.GL.FLOAT};(Ce={})[f.GL.BYTE]=["sint8","snorm16"],Ce[f.GL.UNSIGNED_BYTE]=["uint8","unorm8"],Ce[f.GL.SHORT]=["sint16","unorm16"],Ce[f.GL.UNSIGNED_SHORT]=["uint16","unorm16"],Ce[f.GL.INT]=["sint32","sint32"],Ce[f.GL.UNSIGNED_INT]=["uint32","uint32"],Ce[f.GL.FLOAT]=["float32","float32"],Ce[f.GL.HALF_FLOAT]=["float16","float16"];function we(e){return Me[e]}var Me=((Be={})[f.GL.INT]="sint32",Be[f.GL.UNSIGNED_INT]="uint32",Be[f.GL.SHORT]="sint16",Be[f.GL.UNSIGNED_SHORT]="uint16",Be[f.GL.BYTE]="sint8",Be[f.GL.UNSIGNED_BYTE]="uint8",Be[f.GL.FLOAT]="float32",Be[f.GL.HALF_FLOAT]="float16",Be[f.GL.UNSIGNED_SHORT_5_6_5]="uint16",Be[f.GL.UNSIGNED_SHORT_4_4_4_4]="uint16",Be[f.GL.UNSIGNED_SHORT_5_5_5_1]="uint16",Be[f.GL.UNSIGNED_INT_2_10_10_10_REV]="uint32",Be[f.GL.UNSIGNED_INT_10F_11F_11F_REV]="uint32",Be[f.GL.UNSIGNED_INT_5_9_9_9_REV]="uint32",Be[f.GL.UNSIGNED_INT_24_8]="uint32",Be[f.GL.FLOAT_32_UNSIGNED_INT_24_8_REV]="uint32",Be),Ue=r(1425),We=function(e){function t(t,r){var n;(n=e.call(this,t,r,{byteAlignment:1})||this).sampler=void 0,n._textureUnit=0,n._framebuffer=null,n.device=t,n.gl=n.device.gl;var i=j(n.props.format);n.glTarget=function(e){switch(e){case"1d":case"cube-array":break;case"2d":return f.GL.TEXTURE_2D;case"3d":return f.GL.TEXTURE_3D;case"cube":return f.GL.TEXTURE_CUBE_MAP;case"2d-array":return f.GL.TEXTURE_2D_ARRAY}throw new Error(e)}(n.props.dimension),n.glInternalFormat=i.internalFormat,n.glFormat=i.format,n.glType=i.type,n.compressed=i.compressed,n.handle=n.props.handle||n.gl.createTexture(),n.device._setWebGLDebugMetadata(n.handle,n,{spector:n.props}),n.gl.bindTexture(n.glTarget,n.handle);var a=n,s=a.dimension,o=a.width,u=a.height,c=a.depth,l=a.mipLevels,h=a.glTarget,d=a.glInternalFormat;switch(s){case"2d":case"cube":n.gl.texStorage2D(h,l,d,o,u);break;case"2d-array":case"3d":n.gl.texStorage3D(h,l,d,o,u,c);break;default:throw new Error(s)}return n.gl.bindTexture(n.glTarget,null),n._initializeData(r.data),n.setSampler(n.props.sampler),n.view=new Ne(n.device,Object.assign({},n.props,{texture:n})),Object.seal(n),n}(0,o.A)(t,e);var r=t.prototype;return r.destroy=function(){var e;this.handle&&(null==(e=this._framebuffer)||e.destroy(),this._framebuffer=null,this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)},r.createView=function(e){return new Ne(this.device,Object.assign({},e,{texture:this}))},r.setSampler=function(t){void 0===t&&(t={}),e.prototype.setSampler.call(this,t);var r=pe(this.sampler.props);this._setSamplerParameters(r)},r.copyExternalImage=function(e){var t,r=this,n=this._normalizeCopyExternalImageOptions(e);if(n.sourceX||n.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");var i=this.glFormat,a=this.glType,s=n.image,o=n.depth,u=n.mipLevel,c=n.x,l=n.y,h=n.z,d=n.width,_=n.height,L=ke(this.glTarget,this.dimension,h),E=n.flipY?((t={})[f.GL.UNPACK_FLIP_Y_WEBGL]=!0,t):{};return this.gl.bindTexture(this.glTarget,this.handle),Te(this.gl,E,function(){switch(r.dimension){case"2d":case"cube":r.gl.texSubImage2D(L,u,c,l,d,_,i,a,s);break;case"2d-array":case"3d":r.gl.texSubImage3D(L,u,c,l,h,d,_,o,i,a,s)}}),this.gl.bindTexture(this.glTarget,null),{width:n.width,height:n.height}},r.copyImageData=function(e){var t,r,n,i,a=this,s=this._normalizeCopyImageDataOptions(e),o=s.data,u=s.width,c=s.height,l=s.depth,h=s.z,d=void 0===h?0:h,_=s.mipLevel,L=void 0===_?0:_,E=s.byteOffset,g=void 0===E?0:E,p=s.x,m=void 0===p?0:p,G=s.y,A=void 0===G?0:G,v=this.glFormat,R=this.glType,T=this.compressed,b=ke(this.glTarget,this.dimension,d);if(!this.compressed){var S=this.device.getTextureFormatInfo(this.format).bytesPerPixel;if(S){if(s.bytesPerRow%S!==0)throw new Error("bytesPerRow ("+s.bytesPerRow+") must be a multiple of bytesPerPixel ("+S+") for "+this.format);i=s.bytesPerRow/S}}var C=this.compressed?{}:Object.assign(((t={})[f.GL.UNPACK_ALIGNMENT]=this.byteAlignment,t),void 0!==i?((r={})[f.GL.UNPACK_ROW_LENGTH]=i,r):{},((n={})[f.GL.UNPACK_IMAGE_HEIGHT]=s.rowsPerImage,n));this.gl.bindTexture(this.glTarget,this.handle),Te(this.gl,C,function(){switch(a.dimension){case"2d":case"cube":T?a.gl.compressedTexSubImage2D(b,L,m,A,u,c,v,o,g):a.gl.texSubImage2D(b,L,m,A,u,c,v,R,o,g);break;case"2d-array":case"3d":T?a.gl.compressedTexSubImage3D(b,L,m,A,d,u,c,l,v,o,g):a.gl.texSubImage3D(b,L,m,A,d,u,c,l,v,R,o,g)}}),this.gl.bindTexture(this.glTarget,null)},r.readBuffer=function(e,t){throw void 0===e&&(e={}),new Error("readBuffer not implemented")},r.readDataAsync=function(){var e=(0,se.A)((0,w.A)().m(function e(t){return(0,w.A)().w(function(e){for(;;)if(0===e.n)return void 0===t&&(t={}),e.a(2,this.readDataSyncWebGL(t))},e,this)}));return function(t){return e.apply(this,arguments)}}(),r.writeBuffer=function(e,t){void 0===t&&(t={})},r.writeData=function(e,t){var r,n=this;void 0===t&&(t={});var i=this._normalizeTextureWriteOptions(t),a=ArrayBuffer.isView(e)?e:new Uint8Array(e);(0,ve.A)(this);var s=i.width,o=i.height,u=i.mipLevel,c=i.x,l=i.y,h=i.z,d=this.glFormat,_=this.glType,L=this.compressed,E=ke(this.glTarget,this.dimension,0),g=this.compressed?{}:((r={})[f.GL.UNPACK_ALIGNMENT]=this.byteAlignment,r);this.gl.bindTexture(E,this.handle),this.gl.bindBuffer(f.GL.PIXEL_UNPACK_BUFFER,null),Te(this.gl,g,function(){switch(n.dimension){case"2d":case"cube":L?n.gl.compressedTexSubImage2D(E,u,c,l,s,o,d,a):n.gl.texSubImage2D(E,u,c,l,s,o,d,_,a);break;case"2d-array":case"3d":L?n.gl.compressedTexSubImage3D(E,u,c,l,h,s,o,0,d,a):n.gl.texSubImage3D(E,u,c,l,h,s,o,0,d,_,a)}}),this.gl.bindTexture(E,null)},r._getRowByteAlignment=function(e,t){return 1},r._getFramebuffer=function(){return this._framebuffer||(this._framebuffer=this.device.createFramebuffer({id:"framebuffer-for-"+this.id,width:this.width,height:this.height,colorAttachments:[this]})),this._framebuffer},r.readDataSyncWebGL=function(e){void 0===e&&(e={});var t=this._normalizeTextureReadOptions(e),r=this.computeMemoryLayout(t),n=we(this.glType),i=new((0,Ue.Ak)(n))(r.byteLength),a=ye((0,Ue.h1)(i)),s=this._getFramebuffer(),o=this.gl.bindFramebuffer(f.GL.FRAMEBUFFER,s.handle);return this.gl.readBuffer(f.GL.COLOR_ATTACHMENT0),this.gl.readPixels(t.x,t.y,t.width,t.height,this.glFormat,a,i),this.gl.bindFramebuffer(f.GL.FRAMEBUFFER,o||null),i.buffer},r.generateMipmapsWebGL=function(e){if(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format)||(c.R.warn(this+" is not renderable or filterable, may not be able to generate mipmaps")(),null!=e&&e.force))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(t){c.R.warn("Error generating mipmap for "+this+": "+t.message)()}finally{this.gl.bindTexture(this.glTarget,null)}},r._setSamplerParameters=function(e){c.R.log(2,this.id+" sampler parameters",this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(var t=0,r=Object.entries(e);t<r.length;t++){var n=r[t],i=n[0],a=n[1],s=Number(i),o=a;switch(s){case f.GL.TEXTURE_MIN_LOD:case f.GL.TEXTURE_MAX_LOD:this.gl.texParameterf(this.glTarget,s,o);break;case f.GL.TEXTURE_MAG_FILTER:case f.GL.TEXTURE_MIN_FILTER:case f.GL.TEXTURE_WRAP_S:case f.GL.TEXTURE_WRAP_T:case f.GL.TEXTURE_WRAP_R:this.gl.texParameteri(this.glTarget,s,o);break;case f.GL.TEXTURE_MAX_ANISOTROPY_EXT:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;case f.GL.TEXTURE_COMPARE_MODE:case f.GL.TEXTURE_COMPARE_FUNC:this.gl.texParameteri(this.glTarget,s,o)}}this.gl.bindTexture(this.glTarget,null)},r._getActiveUnit=function(){return this.gl.getParameter(f.GL.ACTIVE_TEXTURE)-f.GL.TEXTURE0},r._bind=function(e){var t=this.gl;return void 0!==e&&(this._textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.glTarget,this.handle),e},r._unbind=function(e){var t=this.gl;return void 0!==e&&(this._textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.glTarget,null),e},t}(Re.g);function ke(e,t,r){return"cube"===t?f.GL.TEXTURE_CUBE_MAP_POSITIVE_X+r:e}var He=r(3145),Ke=r(1464);function Ve(e,t){var r={attributes:[],bindings:[]};r.attributes=function(e,t){for(var r=[],n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var a=e.getActiveAttrib(t,i);if(!a)throw new Error("activeInfo");var s=a.name,o=a.type,u=e.getAttribLocation(t,s);if(u>=0){var c=Ie(o),l=/instance/i.test(s)?"instance":"vertex";r.push({name:s,location:u,stepMode:l,type:c})}}return r.sort(function(e,t){return e.location-t.location}),r}(e,t);for(var n=function(e,t){for(var r=function(r,n){return e.getActiveUniformBlockParameter(t,r,n)},n=[],i=e.getProgramParameter(t,f.GL.ACTIVE_UNIFORM_BLOCKS),a=0;a<i;a++){for(var s={name:e.getActiveUniformBlockName(t,a)||"",location:r(a,f.GL.UNIFORM_BLOCK_BINDING),byteLength:r(a,f.GL.UNIFORM_BLOCK_DATA_SIZE),vertex:r(a,f.GL.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),fragment:r(a,f.GL.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),uniformCount:r(a,f.GL.UNIFORM_BLOCK_ACTIVE_UNIFORMS),uniforms:[]},o=r(a,f.GL.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)||[],u=e.getActiveUniforms(t,o,f.GL.UNIFORM_TYPE),c=e.getActiveUniforms(t,o,f.GL.UNIFORM_SIZE),l=e.getActiveUniforms(t,o,f.GL.UNIFORM_OFFSET),h=e.getActiveUniforms(t,o,f.GL.UNIFORM_ARRAY_STRIDE),d=0;d<s.uniformCount;++d){var _=e.getActiveUniform(t,o[d]);if(!_)throw new Error("activeInfo");var L=Ie(u[d]);s.uniforms.push({name:_.name,format:L,type:u[d],arrayLength:c[d],byteOffset:l[d],byteStride:h[d]})}n.push(s)}return n.sort(function(e,t){return e.location-t.location}),n}(e,t),i=0,a=n;i<a.length;i++){var s=a[i],o=s.uniforms.map(function(e){return{name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength}});r.bindings.push({type:"uniform",name:s.name,group:0,location:s.location,visibility:(s.vertex?1:0)&(s.fragment?2:0),minBindingSize:s.byteLength,uniforms:o})}for(var u=function(e,t){for(var r=[],n=e.getProgramParameter(t,f.GL.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=e.getActiveUniform(t,i);if(!a)throw new Error("activeInfo");var s=a.name,o=a.size,u=a.type,c=Xe(s),l=c.name,h=c.isArray,d=e.getUniformLocation(t,l),_={location:d,name:l,size:o,type:u,isArray:h};if(r.push(_),_.size>1)for(var L=0;L<_.size;L++){var E=l+"["+L+"]";d=e.getUniformLocation(t,E);var g=Object.assign({},_,{name:E,location:d});r.push(g)}}return r}(e,t),c=0,l=0,h=u;l<h.length;l++){var d=h[l];if(Fe(d.type)){var _=Pe(d.type),L=_.viewDimension,E=_.sampleType;r.bindings.push({type:"texture",name:d.name,group:0,location:c,viewDimension:L,sampleType:E}),d.textureUnit=c,c+=1}}u.length&&(r.uniforms=u);var g=function(e,t){for(var r=[],n=e.getProgramParameter(t,f.GL.TRANSFORM_FEEDBACK_VARYINGS),i=0;i<n;i++){var a=e.getTransformFeedbackVarying(t,i);if(!a)throw new Error("activeInfo");var s=a.name,o=a.type,u=a.size,c=Ie(o),l=(0,Ke.k0)(c),h=l.type,d=l.components;r.push({location:i,name:s,type:h,size:u*d})}return r.sort(function(e,t){return e.location-t.location}),r}(e,t);return null!=g&&g.length&&(r.varyings=g),r}function Xe(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name "+e);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function ze(e,t,r,n){var i=e,a=n;!0===a&&(a=1),!1===a&&(a=0);var s="number"==typeof a?[a]:a;switch(r){case f.GL.SAMPLER_2D:case f.GL.SAMPLER_CUBE:case f.GL.SAMPLER_3D:case f.GL.SAMPLER_2D_SHADOW:case f.GL.SAMPLER_2D_ARRAY:case f.GL.SAMPLER_2D_ARRAY_SHADOW:case f.GL.SAMPLER_CUBE_SHADOW:case f.GL.INT_SAMPLER_2D:case f.GL.INT_SAMPLER_3D:case f.GL.INT_SAMPLER_CUBE:case f.GL.INT_SAMPLER_2D_ARRAY:case f.GL.UNSIGNED_INT_SAMPLER_2D:case f.GL.UNSIGNED_INT_SAMPLER_3D:case f.GL.UNSIGNED_INT_SAMPLER_CUBE:case f.GL.UNSIGNED_INT_SAMPLER_2D_ARRAY:if("number"!=typeof n)throw new Error("samplers must be set to integers");return e.uniform1i(t,n);case f.GL.FLOAT:return e.uniform1fv(t,s);case f.GL.FLOAT_VEC2:return e.uniform2fv(t,s);case f.GL.FLOAT_VEC3:return e.uniform3fv(t,s);case f.GL.FLOAT_VEC4:return e.uniform4fv(t,s);case f.GL.INT:return e.uniform1iv(t,s);case f.GL.INT_VEC2:return e.uniform2iv(t,s);case f.GL.INT_VEC3:return e.uniform3iv(t,s);case f.GL.INT_VEC4:return e.uniform4iv(t,s);case f.GL.BOOL:return e.uniform1iv(t,s);case f.GL.BOOL_VEC2:return e.uniform2iv(t,s);case f.GL.BOOL_VEC3:return e.uniform3iv(t,s);case f.GL.BOOL_VEC4:return e.uniform4iv(t,s);case f.GL.UNSIGNED_INT:return i.uniform1uiv(t,s,1);case f.GL.UNSIGNED_INT_VEC2:return i.uniform2uiv(t,s,2);case f.GL.UNSIGNED_INT_VEC3:return i.uniform3uiv(t,s,3);case f.GL.UNSIGNED_INT_VEC4:return i.uniform4uiv(t,s,4);case f.GL.FLOAT_MAT2:return e.uniformMatrix2fv(t,!1,s);case f.GL.FLOAT_MAT3:return e.uniformMatrix3fv(t,!1,s);case f.GL.FLOAT_MAT4:return e.uniformMatrix4fv(t,!1,s);case f.GL.FLOAT_MAT2x3:return i.uniformMatrix2x3fv(t,!1,s);case f.GL.FLOAT_MAT2x4:return i.uniformMatrix2x4fv(t,!1,s);case f.GL.FLOAT_MAT3x2:return i.uniformMatrix3x2fv(t,!1,s);case f.GL.FLOAT_MAT3x4:return i.uniformMatrix3x4fv(t,!1,s);case f.GL.FLOAT_MAT4x2:return i.uniformMatrix4x2fv(t,!1,s);case f.GL.FLOAT_MAT4x3:return i.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}var Ye=function(e){function t(t,r){var n;(n=e.call(this,t,r)||this).uniforms={},n.bindings={},n.varyings=null,n._uniformCount=0,n._uniformSetters={},n.device=t,n.handle=n.props.handle||n.device.gl.createProgram(),n.device._setWebGLDebugMetadata(n.handle,n,{spector:{id:n.props.id}}),n.vs=r.vs,n.fs=r.fs;var i=r.varyings,a=r.bufferMode,s=void 0===a?f.GL.SEPARATE_ATTRIBS:a;return i&&i.length>0&&(n.varyings=i,n.device.gl.transformFeedbackVaryings(n.handle,i,s)),n._linkShaders(),c.R.time(3,"RenderPipeline "+n.id+" - shaderLayout introspection")(),n.introspectedLayout=Ve(n.device.gl,n.handle),c.R.timeEnd(3,"RenderPipeline "+n.id+" - shaderLayout introspection")(),n.shaderLayout=r.shaderLayout?function(e,t){for(var r,n=Object.assign({},e,{attributes:e.attributes.map(function(e){return Object.assign({},e)})}),i=function(){var e=r.value,t=n.attributes.find(function(t){return t.name===e.name});t?(t.type=e.type||t.type,t.stepMode=e.stepMode||t.stepMode):c.R.warn("shader layout attribute "+e.name+" not present in shader")},a=(0,l.A)((null==t?void 0:t.attributes)||[]);!(r=a()).done;)i();return n}(n.introspectedLayout,r.shaderLayout):n.introspectedLayout,n}(0,o.A)(t,e);var r=t.prototype;return r.destroy=function(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)},r.setBindings=function(e,t){for(var r=this,n=function(){var e=a[i],n=e[0],s=e[1],o=r.shaderLayout.bindings.find(function(e){return e.name===n})||r.shaderLayout.bindings.find(function(e){return e.name===n+"Uniforms"});if(!o){var u=r.shaderLayout.bindings.map(function(e){return'"'+e.name+'"'}).join(", ");return null!=t&&t.disableWarnings||c.R.warn('No binding "'+n+'" in render pipeline "'+r.id+'", expected one of '+u,s)(),1}switch(s||c.R.warn('Unsetting binding "'+n+'" in render pipeline "'+r.id+'"')(),o.type){case"uniform":if(!(s instanceof ue||s.buffer instanceof ue))throw new Error("buffer value");break;case"texture":if(!(s instanceof Ne||s instanceof We||s instanceof te))throw new Error(r+" Bad texture binding for "+n);break;case"sampler":c.R.warn("Ignoring sampler "+n)();break;default:throw new Error(o.type)}r.bindings[n]=s},i=0,a=Object.entries(e);i<a.length;i++)n()},r.draw=function(e){var t,r=this,n=e.renderPass,i=e.parameters,a=void 0===i?this.props.parameters:i,s=e.topology,o=void 0===s?this.props.topology:s,u=e.vertexArray,l=e.vertexCount,h=e.instanceCount,d=e.isInstanced,_=void 0!==d&&d,L=e.firstVertex,E=void 0===L?0:L,g=e.transformFeedback,p=function(e){switch(e){case"point-list":return f.GL.POINTS;case"line-list":return f.GL.LINES;case"line-strip":return f.GL.LINE_STRIP;case"triangle-list":return f.GL.TRIANGLES;case"triangle-strip":return f.GL.TRIANGLE_STRIP;default:throw new Error(e)}}(o),m=Boolean(u.indexBuffer),G=null==(t=u.indexBuffer)?void 0:t.glIndexType;if("success"!==this.linkStatus)return c.R.info(2,"RenderPipeline:"+this.id+".draw() aborted - waiting for shader linking")(),!1;if(!this._areTexturesRenderable())return c.R.info(2,"RenderPipeline:"+this.id+".draw() aborted - textures not yet loaded")(),!1;this.device.gl.useProgram(this.handle),u.bindBeforeRender(n),g&&g.begin(this.props.topology),this._applyBindings(),this._applyUniforms();var A=n;return function(e,t,r,n){if(ge(t))return n(e);var i=e;i.pushState();try{return fe(e,t),S(i.gl,r),n(e)}finally{i.popState()}}(this.device,a,A.glParameters,function(){m&&_?r.device.gl.drawElementsInstanced(p,l||0,G,E,h||0):m?r.device.gl.drawElements(p,l||0,G,E):_?r.device.gl.drawArraysInstanced(p,E,l||0,h||0):r.device.gl.drawArrays(p,E,l||0),g&&g.end()}),u.unbindAfterRender(n),!0},r._linkShaders=function(){var e=(0,se.A)((0,w.A)().m(function e(){var t,r,n;return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:if((t=this.device.gl).attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),c.R.time(4,"linkProgram for "+this.id)(),t.linkProgram(this.handle),c.R.timeEnd(4,"linkProgram for "+this.id)(),c.R.level,this.device.features.has("compilation-status-async-webgl")){e.n=1;break}return r=this._getLinkStatus(),this._reportLinkStatus(r),e.a(2);case 1:return c.R.once(1,"RenderPipeline linking is asynchronous")(),e.n=2,this._waitForLinkComplete();case 2:c.R.info(2,"RenderPipeline "+this.id+" - async linking complete: "+this.linkStatus)(),n=this._getLinkStatus(),this._reportLinkStatus(n);case 3:return e.a(2)}},e,this)}));return function(){return e.apply(this,arguments)}}(),r._reportLinkStatus=function(){var e=(0,se.A)((0,w.A)().m(function e(t){var r,n,i,a,s,o;return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:a=t,e.n="success"===a?1:2;break;case 1:return e.a(2);case 2:n="link-error"===t?"Link error":"Validation error",s=this.vs.compilationStatus,e.n="error"===s?3:"pending"===s?4:"success"===s?6:7;break;case 3:throw this.vs.debugShader(),new Error(this+" "+n+" during compilation of "+this.vs);case 4:return e.n=5,this.vs.asyncCompilationStatus;case 5:return this.vs.debugShader(),e.a(3,7);case 6:return e.a(3,7);case 7:o=null==(r=this.fs)?void 0:r.compilationStatus,e.n="error"===o?8:"pending"===o?9:"success"===o?11:12;break;case 8:throw this.fs.debugShader(),new Error(this+" "+n+" during compilation of "+this.fs);case 9:return e.n=10,this.fs.asyncCompilationStatus;case 10:return this.fs.debugShader(),e.a(3,12);case 11:return e.a(3,12);case 12:i=this.device.gl.getProgramInfoLog(this.handle),this.device.reportError(new Error(n+" during "+t+": "+i),this)(),this.device.debug();case 13:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r._getLinkStatus=function(){var e=this.device.gl;return e.getProgramParameter(this.handle,f.GL.LINK_STATUS)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,f.GL.VALIDATE_STATUS)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")},r._waitForLinkComplete=function(){var e=(0,se.A)((0,w.A)().m(function e(){var t,r,n;return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:if(t=function(){var e=(0,se.A)((0,w.A)().m(function e(t){return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,new Promise(function(e){return setTimeout(e,t)});case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),r=10,this.device.features.has("compilation-status-async-webgl")){e.n=2;break}return e.n=1,t(r);case 1:return e.a(2);case 2:n=this.device.gl;case 3:if(!n.getProgramParameter(this.handle,f.GL.COMPLETION_STATUS_KHR)){e.n=4;break}return e.a(2);case 4:return e.n=5,t(r);case 5:e.n=3;break;case 6:return e.a(2)}},e,this)}));return function(){return e.apply(this,arguments)}}(),r._areTexturesRenderable=function(){for(var e,t=!0,r=(0,l.A)(this.shaderLayout.bindings);!(e=r()).done;){var n=e.value;this.bindings[n.name]||this.bindings[n.name.replace(/Uniforms$/,"")]||(c.R.warn("Binding "+n.name+" not found in "+this.id)(),t=!1)}return t},r._applyBindings=function(){if("success"===this.linkStatus){var e=this.device.gl;e.useProgram(this.handle);for(var t,r=0,n=0,i=(0,l.A)(this.shaderLayout.bindings);!(t=i()).done;){var a=t.value,s=this.bindings[a.name]||this.bindings[a.name.replace(/Uniforms$/,"")];if(!s)throw new Error("No value for binding "+a.name+" in "+this.id);switch(a.type){case"uniform":var o=a.name,u=e.getUniformBlockIndex(this.handle,o);if(u===f.GL.INVALID_INDEX)throw new Error("Invalid uniform block name "+o);e.uniformBlockBinding(this.handle,n,u),s instanceof ue?e.bindBufferBase(f.GL.UNIFORM_BUFFER,n,s.handle):e.bindBufferRange(f.GL.UNIFORM_BUFFER,n,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),n+=1;break;case"texture":if(!(s instanceof Ne||s instanceof We||s instanceof te))throw new Error("texture");var h=void 0;if(s instanceof Ne)h=s.texture;else if(s instanceof We)h=s;else{if(!(s instanceof te&&s.colorAttachments[0]instanceof Ne))throw new Error("No texture");c.R.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=s.colorAttachments[0].texture}e.activeTexture(f.GL.TEXTURE0+r),e.bindTexture(h.glTarget,h.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error("binding type '"+a.type+"' not supported in WebGL")}}}},r._applyUniforms=function(){for(var e,t=(0,l.A)(this.shaderLayout.uniforms||[]);!(e=t()).done;){var r,n=e.value,i=n.name,a=n.location,s=n.type,o=n.textureUnit,u=null!=(r=this.uniforms[i])?r:o;void 0!==u&&ze(this.device.gl,a,s,u)}},(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"WEBGLRenderPipeline"}}])}(He.r);var je=r(5524),Qe=function(e){function t(t){var r;return(r=e.call(this,t,{})||this).handle=null,r.commands=[],r.device=t,r}return(0,o.A)(t,e),t.prototype._executeCommands=function(e){void 0===e&&(e=this.commands);for(var t,r=(0,l.A)(e);!(t=r()).done;){var n=t.value;switch(n.name){case"copy-buffer-to-buffer":qe(this.device,n.options);break;case"copy-buffer-to-texture":Ze(this.device,n.options);break;case"copy-texture-to-buffer":Je(this.device,n.options);break;case"copy-texture-to-texture":$e(this.device,n.options);break;default:throw new Error(n.name)}}},t}(r(516).M);function qe(e,t){var r,n,i=t.sourceBuffer,a=t.destinationBuffer;e.gl.bindBuffer(f.GL.COPY_READ_BUFFER,i.handle),e.gl.bindBuffer(f.GL.COPY_WRITE_BUFFER,a.handle),e.gl.copyBufferSubData(f.GL.COPY_READ_BUFFER,f.GL.COPY_WRITE_BUFFER,null!=(r=t.sourceOffset)?r:0,null!=(n=t.destinationOffset)?n:0,t.size),e.gl.bindBuffer(f.GL.COPY_READ_BUFFER,null),e.gl.bindBuffer(f.GL.COPY_WRITE_BUFFER,null)}function Ze(e,t){throw new Error("Not implemented")}function Je(e,t){var r=t.sourceTexture,n=t.mipLevel,i=void 0===n?0:n,a=t.aspect,s=void 0===a?"all":a,o=t.width,u=void 0===o?t.sourceTexture.width:o,c=t.height,l=void 0===c?t.sourceTexture.height:c,h=t.depthOrArrayLayers,d=void 0===h?0:h,_=t.origin,L=void 0===_?[0,0]:_,E=t.destinationBuffer,g=t.byteOffset,p=void 0===g?0:g,m=t.bytesPerRow,G=t.rowsPerImage;if("all"!==s)throw new Error("aspect not supported in WebGL");if(0!==i||0!==d||m||G)throw new Error("not implemented");var A,v=et(r),R=v.framebuffer,T=v.destroyFramebuffer;try{var b=E,S=u||R.width,C=l||R.height,N=j(R.colorAttachments[0].texture.props.format),y=N.format,I=N.type;e.gl.bindBuffer(f.GL.PIXEL_PACK_BUFFER,b.handle),A=e.gl.bindFramebuffer(f.GL.FRAMEBUFFER,R.handle),e.gl.readPixels(L[0],L[1],S,C,y,I,p)}finally{e.gl.bindBuffer(f.GL.PIXEL_PACK_BUFFER,null),void 0!==A&&e.gl.bindFramebuffer(f.GL.FRAMEBUFFER,A),T&&R.destroy()}}function $e(e,t){var r,n,i=t.sourceTexture,a=t.destinationMipLevel,s=void 0===a?0:a,o=t.origin,u=void 0===o?[0,0]:o,c=t.destinationOrigin,l=void 0===c?[0,0]:c,h=t.destinationTexture,d=t.width,_=void 0===d?t.destinationTexture.width:d,L=t.height,E=void 0===L?t.destinationTexture.height:L,g=et(i),p=g.framebuffer,m=g.destroyFramebuffer,G=u[0],A=u[1],v=l[0],R=l[1],T=l[2],b=e.gl.bindFramebuffer(f.GL.FRAMEBUFFER,p.handle);if(!(h instanceof We))throw new Error("invalid destination");switch(r=h,_=Number.isFinite(_)?_:r.width,E=Number.isFinite(E)?E:r.height,r._bind(0),n=r.glTarget){case f.GL.TEXTURE_2D:case f.GL.TEXTURE_CUBE_MAP:e.gl.copyTexSubImage2D(n,s,v,R,G,A,_,E);break;case f.GL.TEXTURE_2D_ARRAY:case f.GL.TEXTURE_3D:e.gl.copyTexSubImage3D(n,s,v,R,T,G,A,_,E)}r&&r._unbind(),e.gl.bindFramebuffer(f.GL.FRAMEBUFFER,b),m&&p.destroy()}function et(e){if(e instanceof Re.g){var t=e.width,r=e.height,n=e.id;return{framebuffer:e.device.createFramebuffer({id:"framebuffer-for-"+n,width:t,height:r,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}var tt=r(7462),rt=[1,2,4,8],nt=function(e){function t(t,r){var n,i,a;if((i=e.call(this,t,r)||this).handle=null,i.glParameters={},i.device=t,null==r||null==(n=r.parameters)||!n.viewport)if(null!=r&&r.framebuffer){var s=r.framebuffer;a=[0,0,s.width,s.height]}else{var o=t.getDefaultCanvasContext().getDrawingBufferSize();a=[0,0,o[0],o[1]]}i.device.pushState(),i.setParameters(Object.assign({viewport:a},i.props.parameters));var u=i.props.framebuffer;if(i.props.framebuffer&&null!=u&&u.handle){var c=i.props.framebuffer.colorAttachments.map(function(e,t){return f.GL.COLOR_ATTACHMENT0+t});i.device.gl.drawBuffers(c)}else i.props.framebuffer||i.device.gl.drawBuffers([f.GL.BACK]);return i.clear(),i}(0,o.A)(t,e);var r=t.prototype;return r.end=function(){this.device.popState()},r.pushDebugGroup=function(e){},r.popDebugGroup=function(){},r.insertDebugMarker=function(e){},r.setParameters=function(e){void 0===e&&(e={});var t=Object.assign({},this.glParameters);t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[f.GL.RASTERIZER_DISCARD]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),void 0!==e.stencilReference&&(t[f.GL.STENCIL_REF]=e.stencilReference,t[f.GL.STENCIL_BACK_REF]=e.stencilReference),"colorMask"in e&&(t.colorMask=rt.map(function(t){return Boolean(t&e.colorMask)})),this.glParameters=t,S(this.device.gl,t)},r.beginOcclusionQuery=function(e){var t=this.props.occlusionQuerySet;null==t||t.beginOcclusionQuery()},r.endOcclusionQuery=function(){var e=this.props.occlusionQuerySet;null==e||e.endOcclusionQuery()},r.clear=function(){var e=this,t=Object.assign({},this.glParameters),r=0;this.props.clearColors&&this.props.clearColors.forEach(function(t,r){t&&e.clearColorBuffer(r,t)}),!1!==this.props.clearColor&&void 0===this.props.clearColors&&(r|=f.GL.COLOR_BUFFER_BIT,t.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(r|=f.GL.DEPTH_BUFFER_BIT,t.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(r|=f.GL.STENCIL_BUFFER_BIT,t.clearStencil=this.props.clearStencil),0!==r&&Te(this.device.gl,t,function(){e.device.gl.clear(r)})},r.clearColorBuffer=function(e,t){var r=this;void 0===e&&(e=0),void 0===t&&(t=[0,0,0,0]),Te(this.device.gl,{framebuffer:this.props.framebuffer},function(){switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:r.device.gl.clearBufferiv(f.GL.COLOR,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:r.device.gl.clearBufferuiv(f.GL.COLOR,e,t);break;case Float32Array:r.device.gl.clearBufferfv(f.GL.COLOR,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})},t}(tt.A),it=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this).handle=null,n.device=t,n.commandBuffer=new Qe(t),n}(0,o.A)(t,e);var r=t.prototype;return r.destroy=function(){},r.finish=function(){return this.commandBuffer},r.beginRenderPass=function(e){return new nt(this.device,e)},r.beginComputePass=function(e){throw new Error("ComputePass not supported in WebGL")},r.copyBufferToBuffer=function(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})},r.copyBufferToTexture=function(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})},r.copyTextureToBuffer=function(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})},r.copyTextureToTexture=function(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})},r.pushDebugGroup=function(e){},r.popDebugGroup=function(){},r.insertDebugMarker=function(e){},r.resolveQuerySet=function(e,t,r){},t}(je.i),at=r(1649),st=r(8639),ot=r(7651);var ut=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this).buffer=null,n.bufferValue=null,n.device=t,n.handle=n.device.gl.createVertexArray(),n}(0,o.A)(t,e),t.isConstantAttributeZeroSupported=function(e){return"Chrome"===(0,ot.X)()};var r=t.prototype;return r.destroy=function(){var t;(e.prototype.destroy.call(this),this.buffer)&&(null==(t=this.buffer)||t.destroy());this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)},r.setIndexBuffer=function(e){var t=e;if(t&&t.glTarget!==f.GL.ELEMENT_ARRAY_BUFFER)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(f.GL.ELEMENT_ARRAY_BUFFER,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)},r.setBuffer=function(e,t){var r=t;if(r.glTarget===f.GL.ELEMENT_ARRAY_BUFFER)throw new Error("Use .setIndexBuffer()");var n=this._getAccessor(e),i=n.size,a=n.type,s=n.stride,o=n.offset,u=n.normalized,c=n.integer,l=n.divisor;this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(f.GL.ARRAY_BUFFER,r.handle),c?this.device.gl.vertexAttribIPointer(e,i,a,s,o):this.device.gl.vertexAttribPointer(e,i,a,u,s,o),this.device.gl.bindBuffer(f.GL.ARRAY_BUFFER,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,l||0),this.attributes[e]=r,this.device.gl.bindVertexArray(null)},r.setConstantWebGL=function(e,t){this._enable(e,!1),this.attributes[e]=t},r.bindBeforeRender=function(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()},r.unbindAfterRender=function(){this.device.gl.bindVertexArray(null)},r._applyConstantAttributes=function(){for(var e=0;e<this.maxVertexAttributes;++e){var t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}},r._getAccessor=function(e){var t=this.attributeInfos[e];if(!t)throw new Error("Unknown attribute location "+e);var r=U(t.bufferDataType);return{size:t.bufferComponents,type:r,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}},r._enable=function(e,r){void 0===r&&(r=!0);var n=t.isConstantAttributeZeroSupported(this.device);(r||(n||0!==e))&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))},r.getConstantBuffer=function(e,t){var r=function(e){if(Array.isArray(e))return new Float32Array(e);return e}(t),n=r.byteLength*e,i=r.length*e;if(this.buffer&&n!==this.buffer.byteLength)throw new Error("Buffer size is immutable, byte length "+n+" !== "+this.buffer.byteLength+".");var a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:n}),a||(a=!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(r,this.bufferValue)),a){var s=(0,at.X)(t.constructor,i);!function(e){for(var t=e.target,r=e.source,n=e.start,i=void 0===n?0:n,a=e.count,s=void 0===a?1:a,o=r.length,u=s*o,c=0,l=i;c<o;c++)t[l++]=r[c];for(;c<u;)c<u-c?(t.copyWithin(i+c,i,i+c),c*=2):(t.copyWithin(i+c,i,i+u-c),c=u);e.target}({target:s,source:r,start:0,count:i}),this.buffer.write(s),this.bufferValue=t}return this.buffer},(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"VertexArray"}}])}(st.o);var ct=r(7862),lt=function(e){function t(r,n){return e.call(this,r,n,t.defaultProps)||this}return(0,o.A)(t,e),(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"TransformFeedback"}}])}(ct.F);lt.defaultProps=Object.assign({},ct.F.defaultProps,{layout:void 0,buffers:{}});var ft=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this).buffers={},n.unusedBuffers={},n.bindOnUse=!0,n._bound=!1,n.device=t,n.gl=t.gl,n.handle=n.props.handle||n.gl.createTransformFeedback(),n.layout=n.props.layout,r.buffers&&n.setBuffers(r.buffers),Object.seal(n),n}(0,o.A)(t,e);var r=t.prototype;return r.destroy=function(){this.gl.deleteTransformFeedback(this.handle),e.prototype.destroy.call(this)},r.begin=function(e){void 0===e&&(e="point-list"),this.gl.bindTransformFeedback(f.GL.TRANSFORM_FEEDBACK,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return f.GL.POINTS;case"line-list":case"line-strip":return f.GL.LINES;case"triangle-list":case"triangle-strip":return f.GL.TRIANGLES;default:throw new Error(e)}}(e))},r.end=function(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(f.GL.TRANSFORM_FEEDBACK,null)},r.setBuffers=function(e){var t=this;this.buffers={},this.unusedBuffers={},this.bind(function(){for(var r in e)t.setBuffer(r,e[r])})},r.setBuffer=function(e,t){var r=this._getVaryingIndex(e),n=this._getBufferRange(t),i=n.buffer,a=n.byteLength,s=n.byteOffset;if(r<0)return this.unusedBuffers[e]=i,void c.R.warn(this.id+" unusedBuffers varying buffer "+e)();this.buffers[r]={buffer:i,byteLength:a,byteOffset:s},this.bindOnUse||this._bindBuffer(r,i,s,a)},r.getBuffer=function(e){if(ht(e))return this.buffers[e]||null;var t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null},r.bind=function(e){return void 0===e&&(e=this.handle),"function"!=typeof e?(this.gl.bindTransformFeedback(f.GL.TRANSFORM_FEEDBACK,e),this):(this._bound?t=e():(this.gl.bindTransformFeedback(f.GL.TRANSFORM_FEEDBACK,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(f.GL.TRANSFORM_FEEDBACK,null)),t);var t},r.unbind=function(){this.bind(null)},r._getBufferRange=function(e){if(e instanceof ue)return{buffer:e,byteOffset:0,byteLength:e.byteLength};var t=e.buffer,r=e.byteOffset,n=void 0===r?0:r,i=e.byteLength;return{buffer:t,byteOffset:n,byteLength:void 0===i?e.buffer.byteLength:i}},r._getVaryingIndex=function(e){if(ht(e))return Number(e);for(var t,r=(0,l.A)(this.layout.varyings||[]);!(t=r()).done;){var n=t.value;if(e===n.name)return n.location}return-1},r._bindBuffers=function(){for(var e in this.buffers){var t=this._getBufferRange(this.buffers[e]),r=t.buffer,n=t.byteLength,i=t.byteOffset;this._bindBuffer(Number(e),r,i,n)}},r._unbindBuffers=function(){for(var e in this.buffers)this.gl.bindBufferBase(f.GL.TRANSFORM_FEEDBACK_BUFFER,Number(e),null)},r._bindBuffer=function(e,t,r,n){void 0===r&&(r=0);var i=t&&t.handle;i&&void 0!==n?this.gl.bindBufferRange(f.GL.TRANSFORM_FEEDBACK_BUFFER,e,i,r,n):this.gl.bindBufferBase(f.GL.TRANSFORM_FEEDBACK_BUFFER,e,i)},t}(lt);function ht(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}var dt=function(e){function t(t,r){var n;if((n=e.call(this,t,r)||this).target=null,n._queryPending=!1,n._pollingPromise=null,n.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");var i=n.device.gl.createQuery();if(!i)throw new Error("WebGL query not supported");return n.handle=i,Object.seal(n),n}(0,o.A)(t,e);var r=t.prototype;return r.destroy=function(){this.device.gl.deleteQuery(this.handle)},r.beginTimestampQuery=function(){return this._begin(f.GL.TIME_ELAPSED_EXT)},r.endTimestampQuery=function(){this._end()},r.beginOcclusionQuery=function(e){return this._begin(null!=e&&e.conservative?f.GL.ANY_SAMPLES_PASSED_CONSERVATIVE:f.GL.ANY_SAMPLES_PASSED)},r.endOcclusionQuery=function(){this._end()},r.beginTransformFeedbackQuery=function(){return this._begin(f.GL.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN)},r.endTransformFeedbackQuery=function(){this._end()},r.resolveQuery=function(){var e=(0,se.A)((0,w.A)().m(function e(){var t;return(0,w.A)().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.pollQuery();case 1:return t=e.v,e.a(2,[t])}},e,this)}));return function(){return e.apply(this,arguments)}}(),r._begin=function(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))},r._end=function(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)},r.isResultAvailable=function(){if(!this._queryPending)return!1;var e=this.device.gl.getQueryParameter(this.handle,f.GL.QUERY_RESULT_AVAILABLE);return e&&(this._queryPending=!1),e},r.isTimerDisjoint=function(){return this.device.gl.getParameter(f.GL.GPU_DISJOINT_EXT)},r.getResult=function(){return this.device.gl.getQueryParameter(this.handle,f.GL.QUERY_RESULT)},r.getTimerMilliseconds=function(){return this.getResult()/1e6},r.pollQuery=function(e){var t=this;if(void 0===e&&(e=Number.POSITIVE_INFINITY),this._pollingPromise)return this._pollingPromise;var r=0;return this._pollingPromise=new Promise(function(n,i){var a=function(){t.isResultAvailable()?(n(t.getResult()),t._pollingPromise=null):r++>e?(i("Timed out"),t._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise},(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"Query"}}])}(r(1101).d),_t=function(e){function t(t,r){var n;void 0===r&&(r={}),(n=e.call(this,t,{})||this)._signaled=!1,n.device=t,n.gl=t.gl;var i=n.props.handle||n.gl.fenceSync(n.gl.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Failed to create WebGL fence");return n.handle=i,n.signaled=new Promise(function(e){var t=function(){var r=n.gl.clientWaitSync(n.handle,0,0);r===n.gl.ALREADY_SIGNALED||r===n.gl.CONDITION_SATISFIED?(n._signaled=!0,e()):setTimeout(t,1)};t()}),n}(0,o.A)(t,e);var r=t.prototype;return r.isSignaled=function(){if(this._signaled)return!0;var e=this.gl.getSyncParameter(this.handle,this.gl.SYNC_STATUS);return this._signaled=e===this.gl.SIGNALED,this._signaled},r.destroy=function(){this.destroyed||this.gl.deleteSync(this.handle)},t}(r(2645).O);function Lt(e){switch(e){case f.GL.ALPHA:case f.GL.R32F:case f.GL.RED:case f.GL.RED_INTEGER:return 1;case f.GL.RG32I:case f.GL.RG32UI:case f.GL.RG32F:case f.GL.RG_INTEGER:case f.GL.RG:return 2;case f.GL.RGB:case f.GL.RGB_INTEGER:case f.GL.RGB32F:return 3;case f.GL.RGBA:case f.GL.RGBA_INTEGER:case f.GL.RGBA32F:return 4;default:return 0}}function Et(e,t){var r,n=t||{},i=n.sourceX,a=void 0===i?0:i,s=n.sourceY,o=void 0===s?0:s,u=n.sourceAttachment,c=void 0===u?0:u,l=t||{},h=l.target,d=void 0===h?null:h,_=l.sourceWidth,L=l.sourceHeight,E=(l.sourceDepth,l.sourceFormat),g=l.sourceType,p=pt(e),m=p.framebuffer,G=p.deleteFramebuffer,A=m.gl,v=m.handle;_||(_=m.width),L||(L=m.height);var R=null==(r=m.colorAttachments[c])?void 0:r.texture;if(!R)throw new Error("Invalid framebuffer attachment "+c);null==R||R.depth,E||(E=(null==R?void 0:R.glFormat)||f.GL.RGBA),g||(g=(null==R?void 0:R.glType)||f.GL.UNSIGNED_BYTE),d=function(e,t,r,n,i){if(e)return e;t||(t=f.GL.UNSIGNED_BYTE);var a=we(t),s=(0,Ue.Ak)(a),o=Lt(r);return new s(n*i*o)}(d,g,E,_,L);var T=(0,Ue.h1)(d);g=g||ye(T);var b=A.bindFramebuffer(f.GL.FRAMEBUFFER,v);return A.readBuffer(A.COLOR_ATTACHMENT0+c),A.readPixels(a,o,_,L,E,g,d),A.readBuffer(A.COLOR_ATTACHMENT0),A.bindFramebuffer(f.GL.FRAMEBUFFER,b||null),G&&m.destroy(),d}function gt(e,t){var r=t||{},n=r.target,i=r.sourceX,a=void 0===i?0:i,s=r.sourceY,o=void 0===s?0:s,u=r.sourceFormat,c=void 0===u?f.GL.RGBA:u,l=r.targetByteOffset,h=void 0===l?0:l,d=t||{},_=d.sourceWidth,L=d.sourceHeight,E=d.sourceType,g=pt(e),p=g.framebuffer,m=g.deleteFramebuffer;_=_||p.width,L=L||p.height;var G=p;E=E||f.GL.UNSIGNED_BYTE;var A=n;if(!A){var v=h+_*L*Lt(c)*function(e){switch(e){case f.GL.UNSIGNED_BYTE:return 1;case f.GL.UNSIGNED_SHORT_5_6_5:case f.GL.UNSIGNED_SHORT_4_4_4_4:case f.GL.UNSIGNED_SHORT_5_5_5_1:return 2;case f.GL.FLOAT:return 4;default:return 0}}(E);A=G.device.createBuffer({byteLength:v})}var R=e.device.createCommandEncoder();return R.copyTextureToBuffer({sourceTexture:e,width:_,height:L,origin:[a,o],destinationBuffer:A,byteOffset:h}),R.destroy(),m&&p.destroy(),A}function pt(e){return e instanceof ee.G?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:mt(e),deleteFramebuffer:!0}}function mt(e,t){var r=e.device,n=e.width,i=e.height,a=e.id;return r.createFramebuffer(Object.assign({},t,{id:"framebuffer-for-"+a,width:n,height:i,colorAttachments:[e]}))}var Gt=function(e){function t(t){var r,n,i;(n=e.call(this,Object.assign({},t,{id:t.id||(i="webgl-device",void 0===i&&(i="id"),ae[i]=ae[i]||1,i+"-"+ae[i]++)}))||this).type="webgl",n.preferredColorFormat="rgba8unorm",n.preferredDepthFormat="depth24plus",n._extensions={},n._polyfilled=!1;var a=u.pF._getCanvasContextProps(t);if(!a)throw new Error("WebGLDevice requires props.createCanvasContext to be set");var s=null==(r=a.canvas)||null==(r=r.gl)?void 0:r.device;if(s)throw new Error("WebGL context already attached to device "+s.id);n.canvasContext=new re(n,a),n.lost=new Promise(function(e){n._resolveContextLost=e});var o=Object.assign({},t.webgl);"premultiplied"===a.alphaMode&&(o.premultipliedAlpha=!0),void 0!==t.powerPreference&&(o.powerPreference=t.powerPreference);var l=n.props._handle||function(e,t,r){var n,i,a="",s=Object.assign({preserveDrawingBuffer:!0},r),o=null;if(o||(o=e.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(a||(a="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),o||r.failIfMajorPerformanceCaveat||(s.failIfMajorPerformanceCaveat=!1,(i=o=e.getContext("webgl2",s)).luma||(i.luma={}),o.luma.softwareRenderer=!0),o||(o=e.getContext("webgl",{}))&&(o=null,a||(a="Your browser only supports WebGL1")),!o)throw a||(a="Your browser does not support WebGL"),new Error("Failed to create WebGL context: "+a);var u=t.onContextLost,c=t.onContextRestored;return e.addEventListener("webglcontextlost",function(e){return u(e)},!1),e.addEventListener("webglcontextrestored",function(e){return c(e)},!1),(n=o).luma||(n.luma={}),o}(n.canvasContext.canvas,{onContextLost:function(e){return null==n._resolveContextLost?void 0:n._resolveContextLost({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:function(e){return console.log("WebGL context restored")}},o);if(!l)throw new Error("WebGL context creation failed");if(s=l.device){if(t._reuseDevices)return c.R.log(1,"Not creating a new Device, instead returning a reference to Device "+s.id+" already attached to WebGL context",s)(),s._reused=!0,s||function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n);throw new Error("WebGL context already attached to device "+s.id)}n.handle=l,n.gl=l,n.spectorJS=(0,ne.k2)(Object.assign({},n.props,{gl:n.handle})),n.gl.device=n,n.gl._version=2,n.info=D(n.gl,n._extensions),n.limits=new J(n.gl),n.features=new Z(n.gl,n._extensions,n.props._disabledFeatures),n.props._initializeFeatures&&n.features.initializeFeatures();var f=new I(n.gl,{log:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return c.R.log.apply(c.R,[1].concat(t))()}});return f.trackState(n.gl,{copyState:!1}),(t.debug||t.debugWebGL)&&(n.gl=(0,ie.l)(n.gl,{debugWebGL:!0,traceWebGL:t.debugWebGL}),c.R.warn("WebGL debug mode activated. Performance reduced.")()),t.debugWebGL&&(c.R.level=Math.max(c.R.level,1)),n.commandEncoder=new it(n,{id:n+"-command-encoder"}),n}(0,o.A)(t,e);var r=t.prototype;return r.toString=function(){return this[Symbol.toStringTag]+"("+this.id+")"},r.isVertexFormatSupported=function(e){return"unorm8x4-bgra"!==e},r.destroy=function(){this.props._reuseDevices||this._reused||delete this.gl.device},r.createCanvasContext=function(e){throw new Error("WebGL only supports a single canvas")},r.createBuffer=function(e){var t=this._normalizeBufferProps(e);return new ue(this,t)},r.createTexture=function(e){return new We(this,e)},r.createExternalTexture=function(e){throw new Error("createExternalTexture() not implemented")},r.createSampler=function(e){return new Ae(this,e)},r.createShader=function(e){return new le(this,e)},r.createFramebuffer=function(e){return new te(this,e)},r.createVertexArray=function(e){return new ut(this,e)},r.createTransformFeedback=function(e){return new ft(this,e)},r.createQuerySet=function(e){return new dt(this,e)},r.createFence=function(){return new _t(this)},r.createRenderPipeline=function(e){return new Ye(this,e)},r.createComputePipeline=function(e){throw new Error("ComputePipeline not supported in WebGL")},r.createCommandEncoder=function(e){return void 0===e&&(e={}),new it(this,e)},r.submit=function(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:this.id+"-default-encoder"})),e._executeCommands()},r.readPixelsToArrayWebGL=function(e,t){return Et(e,t)},r.readPixelsToBufferWebGL=function(e,t){return gt(e,t)},r.setParametersWebGL=function(e){S(this.gl,e)},r.getParametersWebGL=function(e){return C(this.gl,e)},r.withParametersWebGL=function(e,t){return Te(this.gl,e,t)},r.resetWebGL=function(){c.R.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),S(this.gl,h)},r._getDeviceSpecificTextureFormatCapabilities=function(e){return t=this.gl,r=e,n=this._extensions,i=r.create,void 0===(null==(a=Y[r.format])?void 0:a.gl)&&(i=!1),null!=a&&a.x&&(i=i&&Boolean(O(t,a.x,n))),{format:r.format,create:i&&r.create,render:i&&r.render,filter:i&&r.filter,blend:i&&r.blend,store:i&&r.store};var t,r,n,i,a},r.loseDevice=function(){var e,t=!1,r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(t=!0,r.loseContext()),null==(e=this._resolveContextLost)||e.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t},r.pushState=function(){I.get(this.gl).push()},r.popState=function(){I.get(this.gl).pop()},r.getGLKey=function(e,t){var r=Number(e);for(var n in this.gl)if(this.gl[n]===r)return"GL."+n;return null!=t&&t.emptyIfUnknown?"":String(e)},r.getGLKeys=function(e){var t=this,r={emptyIfUnknown:!0};return Object.entries(e).reduce(function(e,n){var i=n[0],a=n[1];return e[i+":"+t.getGLKey(i,r)]=a+":"+t.getGLKey(a,r),e},{})},r.setConstantAttributeWebGL=function(e,t){var r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);var n=this._constants[e];switch(n&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(n,t)&&c.R.info(1,"setConstantAttributeWebGL("+e+") could have been skipped, value unchanged")(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,r){switch(r.length){case 1:e.gl.vertexAttrib1fv(t,r);break;case 2:e.gl.vertexAttrib2fv(t,r);break;case 3:e.gl.vertexAttrib3fv(t,r);break;case 4:e.gl.vertexAttrib4fv(t,r)}}(this,e,t);break;case Int32Array:!function(e,t,r){e.gl.vertexAttribI4iv(t,r)}(this,e,t);break;case Uint32Array:!function(e,t,r){e.gl.vertexAttribI4uiv(t,r)}(this,e,t);break;default:throw new Error("constant")}},r.getExtension=function(e){return O(this.gl,e,this._extensions),this._extensions},r._setWebGLDebugMetadata=function(e,t,r){e.luma=t;var n={props:r.spector,id:r.spector.id};e.__SPECTOR_Metadata=n},(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"WebGLDevice"}},{key:"isLost",get:function(){return this.gl.isContextLost()}}])}(u.pF)},3956:(e,t,r)=>{r.d(t,{Q:()=>a});var n=r(6769),i=r(1166);var a=function(){function e(t){var r,a,o,u,c=this;if(this.isInitialized=!1,this.isVisible=!0,this._initializedResolvers={promise:new Promise(function(e,t){o=e,u=t}),resolve:o,reject:u},this._position=[0,0],this.destroyed=!1,this._needsDrawingBufferResize=!0,this.props=Object.assign({},e.defaultProps,t),t=this.props,this.initialized=this._initializedResolvers.promise,(0,n.B)()?t.canvas?"string"==typeof t.canvas?this.canvas=s(t.canvas):this.canvas=t.canvas:this.canvas=function(e){var t=e.width,r=e.height,n=document.createElement("canvas");n.id=(0,i.L)("lumagl-auto-created-canvas"),n.width=t||1,n.height=r||1,n.style.width=Number.isFinite(t)?t+"px":"100%",n.style.height=Number.isFinite(r)?r+"px":"100%",null!=e&&e.visible||(n.style.visibility="hidden");var a=function(e){if("string"==typeof e){var t=document.getElementById(e);if(!t)throw new Error(e+" is not an HTML element");return t}if(e)return e;return document.body}((null==e?void 0:e.container)||null);return a.insertBefore(n,a.firstChild),n}(t):this.canvas={width:t.width||1,height:t.height||1},e.isHTMLCanvas(this.canvas)?(this.id=t.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):e.isOffscreenCanvas(this.canvas)?(this.id=t.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=t.id||"node-canvas-context",this.type="node"),this.cssWidth=(null==(r=this.htmlCanvas)?void 0:r.clientWidth)||this.canvas.width,this.cssHeight=(null==(a=this.htmlCanvas)?void 0:a.clientHeight)||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],e.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(function(e){return c._handleIntersection(e)}),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(function(e){return c._handleResize(e)});try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch(l){this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(function(){return c._observeDevicePixelRatio()},0),this.props.trackPosition&&this._trackPosition()}}e.isHTMLCanvas=function(e){return"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement},e.isOffscreenCanvas=function(e){return"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas};var t=e.prototype;return t.toString=function(){return this[Symbol.toStringTag]+"("+this.id+")"},t.destroy=function(){this.destroyed=!0},t.setProps=function(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this},t.getCurrentFramebuffer=function(e){return this._resizeDrawingBufferIfNeeded(),this._getCurrentFramebuffer(e)},t.getCSSSize=function(){return[this.cssWidth,this.cssHeight]},t.getPosition=function(){return this._position},t.getDevicePixelSize=function(){return[this.devicePixelWidth,this.devicePixelHeight]},t.getDrawingBufferSize=function(){return[this.drawingBufferWidth,this.drawingBufferHeight]},t.getMaxDrawingBufferSize=function(){var e=this.device.limits.maxTextureDimension2D;return[e,e]},t.setDrawingBufferSize=function(e,t){this.drawingBufferWidth=Math.floor(e),this.drawingBufferHeight=Math.floor(t),this._needsDrawingBufferResize=!0},t.getDevicePixelRatio=function(){return"undefined"!=typeof window&&window.devicePixelRatio||1},t.cssToDevicePixels=function(e,t){void 0===t&&(t=!0);var r=this.cssToDeviceRatio(),n=this.getDrawingBufferSize();return function(e,t,r,n,i){var a,s=e,c=o(s[0],t,r),l=u(s[1],t,n,i),f=o(s[0]+1,t,r),h=f===r-1?f:f-1;f=u(s[1]+1,t,n,i),i?(a=l,l=f=0===f?f:f+1):a=f===n-1?f:f-1;return{x:c,y:l,width:Math.max(h-c+1,1),height:Math.max(a-l+1,1)}}(e,r,n[0],n[1],t)},t.getPixelSize=function(){return this.getDevicePixelSize()},t.getAspect=function(){var e=this.getDevicePixelSize();return e[0]/e[1]},t.cssToDeviceRatio=function(){try{var e=this.getDrawingBufferSize()[0],t=this.getCSSSize()[0];return t?e/t:1}catch(r){return 1}},t.resize=function(e){this.setDrawingBufferSize(e.width,e.height)},t._setAutoCreatedCanvasId=function(e){var t;"lumagl-auto-created-canvas"===(null==(t=this.htmlCanvas)?void 0:t.id)&&(this.htmlCanvas.id=e)},t._handleIntersection=function(e){var t=this,r=e.find(function(e){return e.target===t.canvas});if(r){var n=r.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}},t._handleResize=function(e){var t,r,n=this,i=e.find(function(e){return e.target===n.canvas});if(i){this.cssWidth=i.contentBoxSize[0].inlineSize,this.cssHeight=i.contentBoxSize[0].blockSize;var a=this.getDevicePixelSize(),s=(null==(t=i.devicePixelContentBoxSize)?void 0:t[0].inlineSize)||i.contentBoxSize[0].inlineSize*devicePixelRatio,o=(null==(r=i.devicePixelContentBoxSize)?void 0:r[0].blockSize)||i.contentBoxSize[0].blockSize*devicePixelRatio,u=this.getMaxDrawingBufferSize(),c=u[0],l=u[1];this.devicePixelWidth=Math.max(1,Math.min(s,c)),this.devicePixelHeight=Math.max(1,Math.min(o,l)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:a})}},t._updateDrawingBufferSize=function(){if(this.props.autoResize)if("number"==typeof this.props.useDevicePixels){var e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()},t._resizeDrawingBufferIfNeeded=function(){this._needsDrawingBufferResize&&(this._needsDrawingBufferResize=!1,(this.drawingBufferWidth!==this.canvas.width||this.drawingBufferHeight!==this.canvas.height)&&(this.canvas.width=this.drawingBufferWidth,this.canvas.height=this.drawingBufferHeight,this._configureDevice()))},t._observeDevicePixelRatio=function(){var e=this,t=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:t}),matchMedia("(resolution: "+this.devicePixelRatio+"dppx)").addEventListener("change",function(){return e._observeDevicePixelRatio()},{once:!0})},t._trackPosition=function(e){var t=this;void 0===e&&(e=100);var r=setInterval(function(){t.destroyed?clearInterval(r):t.updatePosition()},e)},t.updatePosition=function(){var e,t=null==(e=this.htmlCanvas)?void 0:e.getBoundingClientRect();if(t){var r=[t.left,t.top];if(null!=this._position||(this._position=r),r[0]!==this._position[0]||r[1]!==this._position[1]){var n,i,a=this._position;this._position=r,null==(n=(i=this.device.props).onPositionChange)||n.call(i,this,{oldPosition:a})}}},e}();function s(e){var t=document.getElementById(e);if(!a.isHTMLCanvas(t))throw new Error("Object is not a canvas element");return t}function o(e,t,r){return Math.min(Math.round(e*t),r-1)}function u(e,t,r,n){return n?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}a.defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1}},4353:(e,t,r)=>{r.d(t,{X:()=>s});var n=r(8696),i=r(7387),a=r(7862),s=function(e){function t(r,n){return e.call(this,r,n,t.defaultProps)||this}return(0,i.A)(t,e),(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"TextureView"}}])}(a.F);s.defaultProps=Object.assign({},a.F.defaultProps,{format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0})},5524:(e,t,r)=>{r.d(t,{i:()=>s});var n=r(8696),i=r(7387),a=r(7862),s=function(e){function t(r,n){return e.call(this,r,n,t.defaultProps)||this}return(0,i.A)(t,e),(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"CommandEncoder"}}])}(a.F);s.defaultProps=Object.assign({},a.F.defaultProps,{measureExecutionTime:void 0})},5768:(e,t,r)=>{r.d(t,{L:()=>s});var n=r(8696),i=r(7387),a=r(7862),s=function(e){function t(r,n){return n=t.normalizeProps(r,n),e.call(this,r,n,t.defaultProps)||this}return(0,i.A)(t,e),t.normalizeProps=function(e,t){return t},(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"Sampler"}}])}(a.F);s.defaultProps=Object.assign({},a.F.defaultProps,{type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1})},7083:(e,t,r)=>{r.d(t,{g:()=>f});var n,i=r(8696),a=r(7387),s=r(7862),o=r(5768),u=r(3522),c=r(116),l={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},f=function(e){function t(r,n,i){var a;if(n=t.normalizeProps(r,n),(a=e.call(this,r,n,t.defaultProps)||this).ready=Promise.resolve(a),a.isReady=!0,a.dimension=a.props.dimension,a.baseDimension=l[a.dimension],a.format=a.props.format,a.width=a.props.width,a.height=a.props.height,a.depth=a.props.depth,a.mipLevels=a.props.mipLevels,"cube"===a.dimension&&(a.depth=6),void 0===a.props.width||void 0===a.props.height)if(r.isExternalImage(n.data)){var s=r.getExternalImageSize(n.data);a.width=(null==s?void 0:s.width)||1,a.height=(null==s?void 0:s.height)||1}else a.width=1,a.height=1,void 0!==a.props.width&&void 0!==a.props.height||u.R.warn(a+" created with undefined width or height. This is deprecated. Use DynamicTexture instead.")();return a.byteAlignment=(null==i?void 0:i.byteAlignment)||1,a.updateTimestamp=r.incrementTimestamp(),a}(0,a.A)(t,e);var r=t.prototype;return r.toString=function(){return"Texture("+this.id+","+this.format+","+this.width+"x"+this.height+")"},r.clone=function(e){return this.device.createTexture(Object.assign({},this.props,e))},r.setSampler=function(e){this.sampler=e instanceof o.L?e:this.device.createSampler(e)},r.computeMemoryLayout=function(e){void 0===e&&(e={});var t=this._normalizeTextureReadOptions(e),r=t.width,n=void 0===r?this.width:r,i=t.height,a=void 0===i?this.height:i,s=t.depthOrArrayLayers,o=void 0===s?this.depth:s,u=this.format,l=this.byteAlignment;return c.vz.computeMemoryLayout({format:u,width:n,height:a,depth:o,byteAlignment:l})},r.readBuffer=function(e,t){throw new Error("readBuffer not implemented")},r.readDataAsync=function(e){throw new Error("readBuffer not implemented")},r.writeBuffer=function(e,t){throw new Error("readBuffer not implemented")},r.writeData=function(e,t){throw new Error("readBuffer not implemented")},r.readDataSyncWebGL=function(e){throw new Error("readDataSyncWebGL not available")},r.generateMipmapsWebGL=function(){throw new Error("generateMipmapsWebGL not available")},t.normalizeProps=function(e,t){var r=Object.assign({},t),n=r.width,i=r.height;return"number"==typeof n&&(r.width=Math.max(1,Math.ceil(n))),"number"==typeof i&&(r.height=Math.max(1,Math.ceil(i))),r},r._initializeData=function(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})},r._normalizeCopyImageDataOptions=function(e){var r=this.width,n=this.height,i=this.depth,a=Object.assign({},t.defaultCopyDataOptions,{width:r,height:n,depth:i},e),s=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!s.bytesPerPixel)throw new Error("bytesPerRow must be provided for texture format "+this.format);return a.bytesPerRow=e.bytesPerRow||r*(s.bytesPerPixel||4),a.rowsPerImage=e.rowsPerImage||n,a},r._normalizeCopyExternalImageOptions=function(e){var r=this.device.getExternalImageSize(e.image),n=Object.assign({},t.defaultCopyExternalImageOptions,r,e);return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n},r._normalizeTextureReadOptions=function(e){var r=this.width,n=this.height,i=Object.assign({},t.defaultTextureReadOptions,{width:r,height:n},e);return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i},r._normalizeTextureWriteOptions=function(e){var r=this.width,n=this.height,i=Object.assign({},t.defaultTextureReadOptions,{width:r,height:n},e);return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i},(0,i.A)(t,[{key:Symbol.toStringTag,get:function(){return"Texture"}}])}(s.F);n=f,f.SAMPLE=4,f.STORAGE=8,f.RENDER=16,f.COPY_SRC=1,f.COPY_DST=2,f.TEXTURE=4,f.RENDER_ATTACHMENT=16,f.defaultProps=Object.assign({},s.F.defaultProps,{data:null,dimension:"2d",format:"rgba8unorm",usage:n.SAMPLE|n.RENDER|n.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0}),f.defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"},f.defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1},f.defaultTextureReadOptions={x:0,y:0,z:0,width:void 0,height:void 0,depthOrArrayLayers:1,mipLevel:0,aspect:"all"}},7462:(e,t,r)=>{r.d(t,{A:()=>o});var n,i=r(8696),a=r(7387),s=r(7862),o=function(e){function t(r,n){return n=t.normalizeProps(r,n),e.call(this,r,n,t.defaultProps)||this}return(0,a.A)(t,e),t.normalizeProps=function(e,t){return t},(0,i.A)(t,[{key:Symbol.toStringTag,get:function(){return"RenderPass"}}])}(s.F);n=o,o.defaultClearColor=[0,0,0,1],o.defaultClearDepth=1,o.defaultClearStencil=0,o.defaultProps=Object.assign({},s.F.defaultProps,{framebuffer:null,parameters:void 0,clearColor:n.defaultClearColor,clearColors:void 0,clearDepth:n.defaultClearDepth,clearStencil:n.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0})},7468:(e,t,r)=>{r.d(t,{M:()=>h});var n=r(2444),i=r(467),a=r(8696),s=r(7387),o=r(7862),u=r(1166),c=r(3845);function l(e,t,r,n){if(null!=n&&n.inlineSource){var i=function(e,t,r){for(var n="",i=t-2;i<=t;i++){var a=e[i-1];void 0!==a&&(n+=f(a,t,r))}return n}(t,r);return"\n"+i+(e.linePos>0?" ".repeat(e.linePos+5)+"^^^\n":"")+e.type.toUpperCase()+": "+e.message+"\n\n"}var a="error"===e.type?"red":"#8B4000";return null!=n&&n.html?"<div class='luma-compiler-log-error' style=\"color:"+a+';"><b> '+e.type.toUpperCase()+": "+e.message+"</b></div>":e.type.toUpperCase()+": "+e.message}function f(e,t,r){var n=null!=r&&r.html?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return function(e,t){for(var r="",n=e.length;n<t;++n)r+=" ";return r+e}(String(t),4)+": "+n+(null!=r&&r.html?"<br/>":"\n")}var h=function(e){function t(r,n){var i;return n=Object.assign({},n,{debugShaders:n.debugShaders||r.props.debugShaders||"errors"}),(i=e.call(this,r,Object.assign({id:d(n)},n),t.defaultProps)||this).compilationStatus="pending",i.stage=i.props.stage,i.source=i.props.source,i}(0,s.A)(t,e);var r=t.prototype;return r.getCompilationInfoSync=function(){return null},r.getTranslatedSource=function(){return null},r.debugShader=function(){var e=(0,i.A)((0,n.A)().m(function e(){var t,r,i;return(0,n.A)().w(function(e){for(;;)switch(e.n){case 0:t=this.props.debugShaders,i=t,e.n="never"===i?1:"errors"===i?2:"warnings"===i||"always"===i?4:5;break;case 1:return e.a(2);case 2:if("success"!==this.compilationStatus){e.n=3;break}return e.a(2);case 3:case 4:return e.a(3,5);case 5:return e.n=6,this.getCompilationInfo();case 6:if(r=e.v,"warnings"!==t||0!==(null==r?void 0:r.length)){e.n=7;break}return e.a(2);case 7:this._displayShaderLog(r,this.id);case 8:return e.a(2)}},e,this)}));return function(){return e.apply(this,arguments)}}(),r._displayShaderLog=function(e,t){var r,n,i=this;if("undefined"!=typeof document&&null!=(r=document)&&r.createElement){var a=t,s=this.stage+' shader "'+a+'"',o=function(e,t,r){var n="",i=t.split(/\r?\n/),a=e.slice().sort(function(e,t){return e.lineNum-t.lineNum});switch((null==r?void 0:r.showSourceCode)||"no"){case"all":for(var s=0,o=1;o<=i.length;o++)for(n+=f(i[o-1],o,r);a.length>s&&a[s].lineNum===o;){var u=a[s++];n+=l(u,i,u.lineNum,Object.assign({},r,{inlineSource:!1}))}for(;a.length>s;)n+=l(a[s++],[],0,Object.assign({},r,{inlineSource:!1}));return n;case"issues":case"no":for(var h,d=(0,c.A)(e);!(h=d()).done;){var _=h.value;n+=l(_,i,_.lineNum,{inlineSource:"no"!==(null==r?void 0:r.showSourceCode)})}return n}}(e,this.source,{showSourceCode:"all",html:!0}),u=this.getTranslatedSource();u&&(o+='<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>'+u+"</pre></code>");var h=document.createElement("Button");h.innerHTML="\n<h1>Compilation error in "+s+'</h1><br /><br />\n<code style="user-select:text;"><pre>\n'+o+"\n</pre></code>",h.style.top="10px",h.style.left="10px",h.style.position="absolute",h.style.zIndex="9999",h.style.width="100%",h.style.textAlign="left",document.body.appendChild(h),null==(n=document.getElementsByClassName("luma-compiler-log-error")[0])||n.scrollIntoView(),h.onclick=function(){var e="data:text/plain,"+encodeURIComponent(i.source);navigator.clipboard.writeText(e)}}},(0,a.A)(t,[{key:Symbol.toStringTag,get:function(){return"Shader"}}])}(o.F);function d(e){return function(e,t){void 0===t&&(t="unnamed");var r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return r?r[1]:t}(e.source)||e.id||(0,u.L)("unnamed "+e.stage+"-shader")}h.defaultProps=Object.assign({},o.F.defaultProps,{language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0})},7651:(e,t,r)=>{r.d(t,{X:()=>s});var n=r(6769),i=r(5399),a=r(5526);function s(e){if(!e&&!(0,n.B)())return"Node";if((0,i.b)(e))return"Electron";return(e||a.gM.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}},8639:(e,t,r)=>{r.d(t,{o:()=>o});var n=r(8696),i=r(7387),a=r(2018),s=r(7862),o=function(e){function t(r,n){var i;return(i=e.call(this,r,n,t.defaultProps)||this).indexBuffer=null,i.maxVertexAttributes=r.limits.maxVertexAttributes,i.attributes=new Array(i.maxVertexAttributes).fill(null),i.attributeInfos=(0,a.M)(n.shaderLayout,n.bufferLayout,i.maxVertexAttributes),i}return(0,i.A)(t,e),t.prototype.setConstantWebGL=function(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()},(0,n.A)(t,[{key:Symbol.toStringTag,get:function(){return"VertexArray"}}])}(s.F);o.defaultProps=Object.assign({},s.F.defaultProps,{shaderLayout:void 0,bufferLayout:[]})}}]);