"use strict";(self.webpackChunkwebsite_docusaurus=self.webpackChunkwebsite_docusaurus||[]).push([[8959],{8453:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>i});var t=n(6540);const s={},d=t.createContext(s);function c(e){const r=t.useContext(d);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(d.Provider,{value:r},e.children)}},8498:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>a,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"api-reference/core/uniform-buffer-layout","title":"UniformBufferLayout","description":"A helper class that lets the application describe the contents of a uniform block and then perform setUniforms({uniform: value}) calls on it, manipulating individual values without concern for memory layout requirements.","source":"@site/../docs/api-reference/core/uniform-buffer-layout.md","sourceDirName":"api-reference/core","slug":"/api-reference/core/uniform-buffer-layout","permalink":"/docs/api-reference/core/uniform-buffer-layout","draft":false,"unlisted":false,"editUrl":"https://github.com/visgl/luma.gl/tree/master/docs/../docs/api-reference/core/uniform-buffer-layout.md","tags":[],"version":"current","frontMatter":{}}');var s=n(4848),d=n(8453);const c={},i="UniformBufferLayout",l={},o=[{value:"Usage",id:"usage",level:2},{value:"Methods",id:"methods",level:2},{value:"constructor",id:"constructor",level:3},{value:"setValues",id:"setvalues",level:3},{value:"getBytes",id:"getbytes",level:3},{value:"getData",id:"getdata",level:3},{value:"getSubData",id:"getsubdata",level:3},{value:"Types",id:"types",level:2},{value:"Remarks",id:"remarks",level:2}];function h(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"uniformbufferlayout",children:"UniformBufferLayout"})}),"\n",(0,s.jsxs)(r.p,{children:["A helper class that lets the application describe the contents of a uniform block and then perform ",(0,s.jsx)(r.code,{children:"setUniforms({uniform: value})"})," calls on it, manipulating individual values without concern for memory layout requirements."]}),"\n",(0,s.jsx)(r.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsxs)(r.p,{children:["Create a ",(0,s.jsx)(r.code,{children:"UniformBufferLayout"})," that matches the uniform block declaration in your shader"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"#version 300 es\nlayout (std140) uniform matrix {\n    mat4 mvp;\n} matrixBlock;\n"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"const matrixBlockLayout = new UniformBufferLayout({\n  mvp: 'mat4x4<f32>'\n});\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Setting values on a ",(0,s.jsx)(r.code,{children:"UniformBufferLayout"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:".setValues({\n  mvp: [1, 0, 0, 0,  0, 1, 0, 0,  0, 0, 1, 0,  0, 0, 0, 1]\n});\n"})}),"\n",(0,s.jsx)(r.p,{children:"Creating a uniform buffer to hold the data required by the layout"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"const layout = new UniformBufferLayout({...});\nconst buffer = new Buffer(gl, {size: layout.getBytes()});\n"})}),"\n",(0,s.jsx)(r.p,{children:"Updating your actual uniform buffer"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"const layout = ...\nlayout.setValues({...})\nbuffer.subData({data: layout.getData()})\n"})}),"\n",(0,s.jsx)(r.p,{children:"Updating a minimal part of the actual uniform buffer"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"const {data, offset} = layout.getSubData();\nbuffer.subData({data, offset});\n"})}),"\n",(0,s.jsx)(r.p,{children:"Binding your uniform buffer"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"TBA;\n"})}),"\n",(0,s.jsx)(r.h2,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(r.h3,{id:"constructor",children:"constructor"}),"\n",(0,s.jsx)(r.p,{children:"Takes a layout object and creates an internal layout description. Once constructed the layout cannot be changed. Once constructed the size of the required memory buffer is known, and the buffer layout provides a convenient interface for updating values."}),"\n",(0,s.jsx)(r.p,{children:"Note: The order and type of the uniforms in the layout object provided to the constructor must match the order and type of the uniform declarations in the GLSL uniform block"}),"\n",(0,s.jsx)(r.h3,{id:"setvalues",children:"setValues"}),"\n",(0,s.jsx)(r.p,{children:"Sets uniform values."}),"\n",(0,s.jsx)(r.h3,{id:"getbytes",children:"getBytes"}),"\n",(0,s.jsxs)(r.p,{children:["Returns the number of bytes needed to hold all the uniforms in the layout, which can be used to create a ",(0,s.jsx)(r.code,{children:"Buffer"})," with enough data to hold the entire memory layout."]}),"\n",(0,s.jsx)(r.h3,{id:"getdata",children:"getData"}),"\n",(0,s.jsxs)(r.p,{children:["Returns a ",(0,s.jsx)(r.code,{children:"Float32Array"})," representing all the memory in the layout. The length of this array (* 4) will correspond to the value returned by ",(0,s.jsx)(r.code,{children:"getBytes()"})]}),"\n",(0,s.jsx)(r.h3,{id:"getsubdata",children:"getSubData"}),"\n",(0,s.jsxs)(r.p,{children:["Returns a ",(0,s.jsx)(r.code,{children:"Float32Array"})," representing all the memory in the layout. The length of this array (* 4) will correspond to the value returned by ",(0,s.jsx)(r.code,{children:"getBytes()"})]}),"\n",(0,s.jsx)(r.h2,{id:"types",children:"Types"}),"\n",(0,s.jsx)(r.p,{children:"Use the following WebGL types to declare uniforms corresponding to your GLSL data types."}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"GLSL Type"}),(0,s.jsx)(r.th,{children:"WebGL type"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"float"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"vec2"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_VEC2"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"vec3"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_VEC3"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"vec4"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_VEC4"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"int"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.INT"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ivec2"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.INT_VEC2"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ivec3"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.INT_VEC3"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ivec4"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.INT_VEC4"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"uint"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.UNSIGNED_INT"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"uvec2"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.UNSIGNED_INT_VEC2"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"uvec3"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.UNSIGNED_INT_VEC3"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"uvec4"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.UNSIGNED_INT_VEC4"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"bool"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.BOOL"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"bvec2"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.BOOL_VEC2"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"bvec3"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.BOOL_VEC3"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"bvec4"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.BOOL_VEC4"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mat2"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_MAT2"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mat3"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_MAT3"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mat4"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_MAT4"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mat2x3"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_MAT2x3"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mat2x4"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_MAT2x4"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mat3x2"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_MAT3x2"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mat3x4"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_MAT3x4"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mat4x2"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_MAT4x2"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mat4x3"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GL.FLOAT_MAT4x3"})})]})]})]}),"\n",(0,s.jsx)(r.h2,{id:"remarks",children:"Remarks"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"WebGL requires the data representing the uniforms in to be laid out in memory according to specific rules (essentially some padding needs to be injected between successive values to facilitate memory access by the GPU)."}),"\n",(0,s.jsxs)(r.li,{children:["More information on the ",(0,s.jsx)(r.code,{children:"std140"})," layout specification: ",(0,s.jsx)(r.a,{href:"https://khronos.org/registry/OpenGL/specs/gl/glspec45.core.pdf#page=137",children:"OpenGL spec"})]}),"\n"]})]})}function a(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);